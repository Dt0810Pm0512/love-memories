<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>致我最爱的你 - 我们的爱情纪念册</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        love: '#FF6B8B',
                        romantic: '#FFB3D9',
                        sweet: '#FFE5EC',
                        warm: '#FFF5F8',
                        tender: '#F8FAFC'
                    },
                    fontFamily: {
                        love: ['Comic Sans MS', 'cursive'],
                        romantic: ['Georgia', 'serif']
                    },
                    animation: {
                        'float': 'float 3s ease-in-out infinite',
                        'pulse-soft': 'pulse 2s ease-in-out infinite',
                        'bounce-gentle': 'bounce 2s infinite',
                        'fade-in': 'fadeIn 0.5s ease-out forwards',
                        'slide-up': 'slideUp 0.5s ease-out forwards',
                        'scale-in': 'scaleIn 0.3s ease-out forwards',
                        'heart-beat': 'heartBeat 1.5s ease-in-out infinite',
                        'float-slow': 'float 6s ease-in-out infinite'
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .glass-effect {
                backdrop-filter: blur(10px);
                background: rgba(255, 255, 255, 0.9);
            }
            .gradient-love {
                background: linear-gradient(135deg, #FFE5EC 0%, #FFB3D9 50%, #FF6B8B 100%);
            }
            .gradient-soft {
                background: linear-gradient(135deg, #FFF5F8 0%, #FFE5EC 100%);
            }
            .card-shadow-love {
                box-shadow: 0 20px 40px rgba(255, 107, 139, 0.2);
            }
            .hover-lift-love {
                transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            }
            .hover-lift-love:hover {
                transform: translateY(-8px) scale(1.02);
                box-shadow: 0 25px 50px rgba(255, 107, 139, 0.3);
            }
        }
        
        @keyframes float {
            0%, 100% { transform: translateY(0px); }
            50% { transform: translateY(-10px); }
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes slideUp {
            from { opacity: 0; transform: translateY(30px); }
            to { opacity: 1; transform: translateY(0); }
        }
        
        @keyframes scaleIn {
            from { opacity: 0; transform: scale(0.9); }
            to { opacity: 1; transform: scale(1); }
        }
        
        @keyframes heartBeat {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }
        
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #FF6B8B;
            border-radius: 3px;
        }
        
        .custom-scrollbar::-webkit-scrollbar-thumb:hover {
            background: #FF527B;
        }
        
        .modal-backdrop {
            backdrop-filter: blur(8px);
            background: rgba(0, 0, 0, 0.3);
        }
        
        .floating-heart {
            animation: float-slow 6s ease-in-out infinite;
        }
        
        .floating-heart:nth-child(2) {
            animation-delay: 1s;
        }
        
        .floating-heart:nth-child(3) {
            animation-delay: 2s;
        }
        
        .floating-heart:nth-child(4) {
            animation-delay: 3s;
        }
        
        .module-card-love {
            background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 239, 245, 0.95) 100%);
            border: 2px solid rgba(255, 107, 139, 0.2);
        }
        
        .delete-btn-love {
            transition: all 0.3s ease;
        }
        
        .delete-btn-love:hover {
            transform: scale(1.1);
            background: #ef4444 !important;
            color: white !important;
        }
        
        .love-text {
            background: linear-gradient(45deg, #FF6B8B, #FFB3D9);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .heart-icon {
            color: #FF6B8B;
            animation: heart-beat 1.5s ease-in-out infinite;
        }
        
        .photo-frame {
            border: 4px solid #FFB3D9;
            border-radius: 20px;
            box-shadow: 0 8px 25px rgba(255, 107, 139, 0.3);
        }
        
        .message-bubble {
            background: linear-gradient(135deg, #FFE5EC, #FFB3D9);
            border-radius: 20px 20px 20px 5px;
            box-shadow: 0 4px 15px rgba(255, 107, 139, 0.2);
        }
        
        .message-bubble-reply {
            background: linear-gradient(135deg, #E5F3FF, #B3D9FF);
            border-radius: 20px 20px 5px 20px;
            box-shadow: 0 4px 15px rgba(107, 179, 255, 0.2);
        }
    </style>
</head>
<body class="gradient-love min-h-screen custom-scrollbar overflow-x-hidden">
    <!-- 浮动爱心装饰 -->
    <div class="fixed top-20 left-10 pointer-events-none z-10">
        <div class="floating-heart text-love/30">
            <i class="fa fa-heart text-2xl heart-icon"></i>
        </div>
    </div>
    <div class="fixed top-40 right-10 pointer-events-none z-10">
        <div class="floating-heart text-love/30">
            <i class="fa fa-heart text-xl heart-icon"></i>
        </div>
    </div>
    <div class="fixed bottom-40 left-20 pointer-events-none z-10">
        <div class="floating-heart text-love/30">
            <i class="fa fa-heart text-lg heart-icon"></i>
        </div>
    </div>
    <div class="fixed bottom-20 right-20 pointer-events-none z-10">
        <div class="floating-heart text-love/30">
            <i class="fa fa-heart text-xl heart-icon"></i>
        </div>
    </div>

    <!-- 导航栏 -->
    <nav class="glass-effect border-b border-white/30 sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-12 h-12 bg-love rounded-full flex items-center justify-center animate-heart-beat">
                        <i class="fa fa-heart text-white text-xl"></i>
                    </div>
                    <h1 class="text-2xl font-bold love-text font-love" id="siteTitle">致我最爱的你</h1>
                </div>
                <div class="flex items-center space-x-4">
                    <button id="syncBtn" class="text-love hover:text-pink-600 transition-colors duration-300 p-2 rounded-full hover:bg-white/50 relative">
                        <i class="fa fa-cloud"></i>
                        <span id="syncBadge" class="absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full text-white text-xs flex items-center justify-center hidden">✓</span>
                    </button>
                    <button id="settingsBtn" class="text-love hover:text-pink-600 transition-colors duration-300 p-2 rounded-full hover:bg-white/50">
                        <i class="fa fa-cog"></i>
                    </button>
                </div>
            </div>
        </div>
    </nav>

    <!-- 主要内容 -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        
        <!-- 欢迎区域 -->
        <section class="text-center mb-12 animate-fade-in">
            <div class="mb-8">
                <h2 class="text-4xl md:text-6xl font-bold love-text font-love mb-4 animate-heart-beat" id="welcomeTitle">
                    亲爱的，有你真好
                </h2>
                <p class="text-lg md:text-xl text-gray-700 max-w-2xl mx-auto font-romantic" id="welcomeSubtitle">
                    每一天都想告诉你，你是我生命中最美的礼物，我们的爱情故事还在继续...
                </p>
            </div>
            
            <!-- 恋爱时间显示 -->
            <div class="bg-white/90 rounded-3xl p-8 max-w-lg mx-auto card-shadow-love animate-scale-in">
                <div class="flex items-center justify-center space-x-3 mb-4">
                    <i class="fa fa-heart text-love text-2xl heart-icon"></i>
                    <span class="text-xl font-semibold text-gray-800 font-love" id="loveTimeLabel">我们相爱了</span>
                </div>
                <div class="text-4xl lg:text-5xl font-bold love-text font-love mb-4" id="loveTime">
                    0 天 0 时 0 分 0 秒
                </div>
                <p class="text-gray-600 font-romantic" id="loveTimeDesc">
                    每一分每一秒都值得珍藏
                </p>
                <button id="startLoveBtn" class="mt-6 bg-love hover:bg-pink-600 text-white px-8 py-3 rounded-full text-lg font-semibold transition-all duration-300 transform hover:scale-105 hover:shadow-lg">
                    <i class="fa fa-heart mr-2"></i>开始记录我们的爱情时光
                </button>
            </div>
        </section>

        <!-- 功能模块入口 -->
        <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 md:gap-8 animate-slide-up">
            
            <!-- 甜蜜相册 -->
            <div class="module-card-love rounded-3xl p-6 hover-lift-love cursor-pointer" onclick="openModule('photos')">
                <div class="text-center">
                    <div class="w-20 h-20 bg-gradient-to-br from-love to-pink-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-camera text-white text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold love-text font-love mb-2" id="modulePhotos">甜蜜相册</h3>
                    <p class="text-gray-600 text-sm mb-4 font-romantic" id="modulePhotosDesc">记录我们的每一个美好瞬间</p>
                    <div class="flex items-center justify-center text-love">
                        <span class="text-sm font-medium font-love" id="enterPhotos">查看回忆</span>
                        <i class="fa fa-arrow-right ml-2 text-sm"></i>
                    </div>
                </div>
            </div>

            <!-- 爱的告白 -->
            <div class="module-card-love rounded-3xl p-6 hover-lift-love cursor-pointer" onclick="openModule('voices')">
                <div class="text-center">
                    <div class="w-20 h-20 bg-gradient-to-br from-purple-400 to-pink-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-music text-white text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold love-text font-love mb-2" id="moduleVoices">爱的告白</h3>
                    <p class="text-gray-600 text-sm mb-4 font-romantic" id="moduleVoicesDesc">留下想对你说的悄悄话</p>
                    <div class="flex items-center justify-center text-love">
                        <span class="text-sm font-medium font-love" id="enterVoices">聆听心声</span>
                        <i class="fa fa-arrow-right ml-2 text-sm"></i>
                    </div>
                </div>
            </div>

            <!-- 爱情日记 -->
            <div class="module-card-love rounded-3xl p-6 hover-lift-love cursor-pointer" onclick="openModule('diary')">
                <div class="text-center">
                    <div class="w-20 h-20 bg-gradient-to-br from-blue-400 to-pink-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-book text-white text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold love-text font-love mb-2" id="moduleDiary">爱情日记</h3>
                    <p class="text-gray-600 text-sm mb-4 font-romantic" id="moduleDiaryDesc">写下我们的爱情故事</p>
                    <div class="flex items-center justify-center text-love">
                        <span class="text-sm font-medium font-love" id="enterDiary">记录点滴</span>
                        <i class="fa fa-arrow-right ml-2 text-sm"></i>
                    </div>
                </div>
            </div>

            <!-- 甜蜜留言 -->
            <div class="module-card-love rounded-3xl p-6 hover-lift-love cursor-pointer" onclick="openModule('messages')">
                <div class="text-center">
                    <div class="w-20 h-20 bg-gradient-to-br from-green-400 to-pink-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-heart text-white text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold love-text font-love mb-2" id="moduleMessages">甜蜜留言</h3>
                    <p class="text-gray-600 text-sm mb-4 font-romantic" id="moduleMessagesDesc">想对你说的话都在这里</p>
                    <div class="flex items-center justify-center text-love">
                        <span class="text-sm font-medium font-love" id="enterMessages">写留言</span>
                        <i class="fa fa-arrow-right ml-2 text-sm"></i>
                    </div>
                </div>
            </div>

            <!-- 重要纪念日 -->
            <div class="module-card-love rounded-3xl p-6 hover-lift-love cursor-pointer" onclick="openModule('dates')">
                <div class="text-center">
                    <div class="w-20 h-20 bg-gradient-to-br from-yellow-400 to-pink-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-calendar text-white text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold love-text font-love mb-2" id="moduleDates">重要纪念日</h3>
                    <p class="text-gray-600 text-sm mb-4 font-romantic" id="moduleDatesDesc">记录我们的特殊日子</p>
                    <div class="flex items-center justify-center text-love">
                        <span class="text-sm font-medium font-love" id="enterDates">查看日历</span>
                        <i class="fa fa-arrow-right ml-2 text-sm"></i>
                    </div>
                </div>
            </div>

            <!-- 爱情统计 -->
            <div class="module-card-love rounded-3xl p-6 hover-lift-love cursor-pointer" onclick="openModule('album')">
                <div class="text-center">
                    <div class="w-20 h-20 bg-gradient-to-br from-indigo-400 to-pink-400 rounded-2xl flex items-center justify-center mx-auto mb-4">
                        <i class="fa fa-heart text-white text-3xl"></i>
                    </div>
                    <h3 class="text-2xl font-bold love-text font-love mb-2" id="moduleAlbum">爱情统计</h3>
                    <p class="text-gray-600 text-sm mb-4 font-romantic" id="moduleAlbumDesc">我们的爱情数据</p>
                    <div class="flex items-center justify-center text-love">
                        <span class="text-sm font-medium font-love" id="enterAlbum">查看统计</span>
                        <i class="fa fa-arrow-right ml-2 text-sm"></i>
                    </div>
                </div>
            </div>
        </section>

        <!-- 甜蜜留言预览 -->
        <section class="mt-12 animate-fade-in">
            <div class="bg-white/90 rounded-3xl p-8 card-shadow-love">
                <h3 class="text-2xl font-bold love-text font-love text-center mb-6" id="recentMessagesTitle">
                    <i class="fa fa-heart mr-2 heart-icon"></i>最近的甜蜜留言
                </h3>
                <div id="recentMessagesList" class="space-y-4 max-h-64 overflow-y-auto custom-scrollbar">
                    <!-- 示例留言 -->
                    <div class="message-bubble p-4 animate-slide-up">
                        <div class="flex items-start space-x-3">
                            <div class="w-8 h-8 bg-love rounded-full flex items-center justify-center flex-shrink-0">
                                <span class="text-white text-xs font-bold">我</span>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center justify-between mb-1">
                                    <div class="flex items-center space-x-2">
                                        <span class="font-semibold text-gray-800 text-sm font-love">我</span>
                                        <span class="text-xs text-gray-500">刚刚</span>
                                    </div>
                                </div>
                                <p class="text-gray-700 text-sm font-romantic">亲爱的，今天也超级爱你！你是我生命中最美的阳光，有你在身边每天都充满温暖。</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- 底部 -->
    <footer class="glass-effect border-t border-white/30 py-8 mt-16">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 text-center">
            <div class="flex justify-center items-center space-x-3 mb-4">
                <div class="w-10 h-10 bg-love rounded-full flex items-center justify-center">
                    <i class="fa fa-heart text-white"></i>
                </div>
                <span class="text-xl font-bold love-text font-love" id="footerTitle">致我最爱的你</span>
            </div>
            <p class="text-gray-700 text-sm font-romantic mb-4" id="footerSubtitle">愿我们的爱情永远甜蜜如初</p>
            <div class="flex justify-center space-x-6 text-sm text-gray-600">
                <span id="footerMadeWith" class="font-love">用❤️制作</span>
                <span>•</span>
                <span id="footerForever" class="font-love">永远在一起</span>
            </div>
        </div>
    </footer>

    <!-- 模块弹窗 -->
    <!-- 照片模块 -->
    <div id="photosModal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-5xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold love-text font-love">
                        <i class="fa fa-camera text-love mr-3"></i><span id="modalPhotosTitle">甜蜜相册</span>
                    </h3>
                    <button onclick="closeModule('photos')" class="text-gray-400 hover:text-love transition-colors duration-300">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)] custom-scrollbar">
                    <!-- 上传区域 -->
                    <div class="border-2 border-dashed border-love/30 rounded-2xl p-8 text-center hover:border-love transition-colors duration-300 cursor-pointer mb-8 animate-fade-in" onclick="document.getElementById('photoInput').click()">
                        <i class="fa fa-cloud-upload text-4xl text-love mb-4"></i>
                        <h4 class="text-lg font-semibold love-text font-love mb-2" id="uploadPhotosTitle">上传甜蜜照片</h4>
                        <p class="text-gray-600 text-sm font-romantic" id="uploadPhotosDesc">把我们的美好瞬间保存下来</p>
                        <input type="file" id="photoInput" class="hidden" accept="image/*" multiple>
                    </div>
                    
                    <!-- 照片网格 -->
                    <div id="photosGrid" class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                        <!-- 示例照片 -->
                        <div class="photo-item bg-gray-100 rounded-xl overflow-hidden hover:scale-105 transition-transform duration-300 cursor-pointer relative photo-frame" onclick="openPhotoViewer(this)">
                            <img src="https://doc.doubao.com/s/HLfGw4b69Q4/" alt="甜蜜瞬间" class="w-full h-32 object-cover">
                            <div class="p-2 text-xs text-gray-600 font-love">第一次约会</div>
                            <button onclick="event.stopPropagation(); deletePhoto(1)" class="delete-btn-love absolute top-1 right-1 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center opacity-70 hover:opacity-100">
                                <i class="fa fa-trash"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 语音模块 -->
    <div id="voicesModal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-3xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold love-text font-love">
                        <i class="fa fa-music text-love mr-3"></i><span id="modalVoicesTitle">爱的告白</span>
                    </h3>
                    <button onclick="closeModule('voices')" class="text-gray-400 hover:text-love transition-colors duration-300">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)] custom-scrollbar">
                    <!-- 上传区域 -->
                    <div class="border-2 border-dashed border-love/30 rounded-2xl p-6 text-center hover:border-love transition-colors duration-300 cursor-pointer mb-6 animate-fade-in" onclick="document.getElementById('voiceInput').click()">
                        <i class="fa fa-upload text-3xl text-love mb-3"></i>
                        <h4 class="text-lg font-semibold love-text font-love mb-1" id="uploadVoicesTitle">上传语音告白</h4>
                        <p class="text-gray-600 text-sm font-romantic" id="uploadVoicesDesc">把想对我说的话录下来</p>
                        <input type="file" id="voiceInput" class="hidden" accept="audio/*" multiple>
                    </div>
                    
                    <!-- 语音列表 -->
                    <div id="voicesList" class="space-y-4">
                        <!-- 示例语音 -->
                        <div class="voice-item bg-gradient-to-r from-sweet to-warm rounded-xl p-4 flex items-center justify-between animate-slide-up">
                            <div class="flex items-center space-x-4">
                                <div class="w-14 h-14 bg-love rounded-full flex items-center justify-center">
                                    <i class="fa fa-heart text-white text-xl"></i>
                                </div>
                                <div>
                                    <h4 class="font-semibold love-text font-love">甜蜜告白</h4>
                                    <p class="text-gray-600 text-sm font-romantic">2024年2月14日 · 30秒</p>
                                </div>
                            </div>
                            <div class="flex items-center space-x-2">
                                <button class="text-love hover:text-pink-600 transition-colors duration-300" onclick="playVoice(this)">
                                    <i class="fa fa-play-circle text-2xl"></i>
                                </button>
                                <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300" onclick="deleteVoice(1)">
                                    <i class="fa fa-trash text-xl"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 日记模块 -->
    <div id="diaryModal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold love-text font-love">
                        <i class="fa fa-book text-love mr-3"></i><span id="modalDiaryTitle">爱情日记</span>
                    </h3>
                    <button onclick="closeModule('diary')" class="text-gray-400 hover:text-love transition-colors duration-300">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)] custom-scrollbar">
                    <!-- 写日记区域 -->
                    <div class="bg-gradient-to-r from-sweet to-warm rounded-2xl p-6 mb-8 animate-fade-in">
                        <div class="flex items-center justify-between mb-4">
                            <h4 class="text-lg font-semibold love-text font-love" id="writeDiaryTitle">写下我们的故事</h4>
                            <span class="text-sm text-gray-600 font-romantic" id="diaryDate"></span>
                        </div>
                        <input type="text" id="newDiaryTitle" placeholder="今天的标题..." class="w-full p-3 border border-love/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-love mb-4 font-love">
                        <textarea id="newDiaryContent" placeholder="今天和亲爱的一起做了什么呢？记录下我们的甜蜜时光..." class="w-full p-3 border border-love/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-love resize-none h-32 font-romantic"></textarea>
                        <button onclick="saveDiary()" class="mt-4 bg-love hover:bg-pink-600 text-white px-6 py-2 rounded-full transition-colors duration-300 font-love">
                            <i class="fa fa-heart mr-2"></i><span id="saveDiaryBtn">保存回忆</span>
                        </button>
                    </div>
                    
                    <!-- 日记列表 -->
                    <div id="diaryList" class="space-y-4">
                        <!-- 示例日记 -->
                        <div class="diary-item bg-gradient-to-r from-warm to-sweet rounded-xl p-6 animate-slide-up">
                            <div class="flex items-start justify-between mb-3">
                                <h4 class="font-semibold love-text font-love text-lg">第一次约会</h4>
                                <span class="text-xs text-gray-600 font-romantic">2024年1月15日</span>
                            </div>
                            <p class="text-gray-700 mb-4 font-romantic">今天和心爱的人第一次正式约会，我们去了那家一直想去的咖啡馆。阳光透过窗户洒在她的脸上，那一刻我觉得整个世界都变得温柔了。她的笑容那么甜美，让我心动不已。这是我们爱情故事的开始，我会永远珍藏这美好的一天。</p>
                            <div class="flex items-center justify-between">
                                <button class="text-love hover:text-pink-600 transition-colors duration-300 text-sm font-love">
                                    <i class="fa fa-heart mr-1"></i><span id="viewCommentsBtn">爱的回应</span> (3)
                                </button>
                                <div class="flex space-x-2">
                                    <button class="text-gray-400 hover:text-love transition-colors duration-300">
                                        <i class="fa fa-edit"></i>
                                    </button>
                                    <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300" onclick="deleteDiary(1)">
                                        <i class="fa fa-trash"></i>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 留言模块 -->
    <div id="messagesModal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-3xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold love-text font-love">
                        <i class="fa fa-heart text-love mr-3"></i><span id="modalMessagesTitle">甜蜜留言</span>
                    </h3>
                    <button onclick="closeModule('messages')" class="text-gray-400 hover:text-love transition-colors duration-300">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)] custom-scrollbar">
                    <!-- 写留言区域 -->
                    <div class="bg-gradient-to-r from-sweet to-warm rounded-2xl p-6 mb-8 animate-fade-in">
                        <h4 class="text-lg font-semibold love-text font-love mb-4" id="writeMessageTitle">想对亲爱的说</h4>
                        <textarea id="newMessage" placeholder="亲爱的，我想对你说..." class="w-full p-3 border border-love/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-love resize-none h-24 mb-4 font-romantic"></textarea>
                        <button onclick="saveMessage()" class="bg-love hover:bg-pink-600 text-white px-6 py-2 rounded-full transition-colors duration-300 font-love">
                            <i class="fa fa-heart mr-2"></i><span id="sendMessageBtn">发送我的爱</span>
                        </button>
                    </div>
                    
                    <!-- 留言列表 -->
                    <div id="messagesList" class="space-y-4">
                        <!-- 示例留言 -->
                        <div class="message-bubble p-4 animate-slide-up">
                            <div class="flex items-start space-x-3">
                                <div class="w-8 h-8 bg-love rounded-full flex items-center justify-center flex-shrink-0">
                                    <span class="text-white text-xs font-bold font-love">我</span>
                                </div>
                                <div class="flex-1">
                                    <div class="flex items-center justify-between mb-1">
                                        <div class="flex items-center space-x-2">
                                            <span class="font-semibold love-text font-love text-sm">我</span>
                                            <span class="text-xs text-gray-600 font-romantic">2分钟前</span>
                                        </div>
                                        <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300">
                                            <i class="fa fa-trash text-sm"></i>
                                        </button>
                                    </div>
                                    <p class="text-gray-700 text-sm mb-2 font-romantic">亲爱的，今天真的很开心，有你在身边感觉好幸福。你是我生命中最美的礼物，我会永远珍惜我们在一起的每一天。</p>
                                    <button class="text-love hover:text-pink-600 transition-colors duration-300 text-xs font-love">
                                        <i class="fa fa-heart mr-1"></i><span id="replyBtn">爱的回应</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 日期模块 -->
    <div id="datesModal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold love-text font-love">
                        <i class="fa fa-calendar text-love mr-3"></i><span id="modalDatesTitle">重要纪念日</span>
                    </h3>
                    <button onclick="closeModule('dates')" class="text-gray-400 hover:text-love transition-colors duration-300">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)] custom-scrollbar">
                    <!-- 添加日期 -->
                    <div class="bg-gradient-to-r from-sweet to-warm rounded-2xl p-6 mb-8 animate-fade-in">
                        <h4 class="text-lg font-semibold love-text font-love mb-4" id="addDateTitle">添加特殊日子</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4 mb-4">
                            <input type="date" id="newDate" class="p-3 border border-love/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-love font-love">
                            <input type="text" id="newDateTitle" placeholder="给这个日子起个名字..." class="p-3 border border-love/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-love font-love">
                        </div>
                        <textarea id="newDateDescription" placeholder="这一天对我们有什么特别的意义呢？" class="w-full p-3 border border-love/30 rounded-xl focus:outline-none focus:ring-2 focus:ring-love resize-none h-20 mb-4 font-romantic"></textarea>
                        <button onclick="saveDate()" class="bg-love hover:bg-pink-600 text-white px-6 py-2 rounded-full transition-colors duration-300 font-love">
                            <i class="fa fa-heart mr-2"></i><span id="addDateBtn">保存这个特殊日子</span>
                        </button>
                    </div>
                    
                    <!-- 日期列表 -->
                    <div id="datesList" class="space-y-4">
                        <!-- 示例日期 -->
                        <div class="date-item bg-gradient-to-r from-warm to-sweet rounded-xl p-4 animate-slide-up">
                            <div class="flex items-start justify-between mb-2">
                                <h4 class="font-semibold love-text font-love">第一次约会</h4>
                                <div class="flex items-center space-x-2">
                                    <span class="text-xs text-gray-600 font-romantic">2024年1月15日</span>
                                    <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300" onclick="deleteDate(1)">
                                        <i class="fa fa-trash text-sm"></i>
                                    </button>
                                </div>
                            </div>
                            <p class="text-gray-700 text-sm mb-2 font-romantic">在海边咖啡馆的浪漫约会，我们的爱情故事从这里开始</p>
                            <div class="text-love text-sm font-medium font-love">
                                <i class="fa fa-heart mr-1 heart-icon"></i>已过去 287 天
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 相册模块 -->
    <div id="albumModal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-5xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold love-text font-love">
                        <i class="fa fa-heart text-love mr-3 heart-icon"></i><span id="modalAlbumTitle">我们的爱情统计</span>
                    </h3>
                    <button onclick="closeModule('album')" class="text-gray-400 hover:text-love transition-colors duration-300">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)] custom-scrollbar">
                    <div class="text-center mb-8 animate-fade-in">
                        <h4 class="text-2xl font-bold love-text font-love mb-2" id="memoriesTitle">我们的爱情数据</h4>
                        <p class="text-gray-600 font-romantic" id="memoriesDesc">每一个数字都代表着我们的爱</p>
                    </div>
                    
                    <!-- 同步状态 -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-4 mb-6 border border-blue-200 animate-slide-up">
                        <div class="flex items-center justify-between">
                            <div class="flex items-center space-x-3">
                                <i class="fa fa-cloud text-blue-500 text-xl"></i>
                                <div>
                                    <div class="font-semibold text-gray-800 font-love" id="syncStatusTitle">云端同步状态</div>
                                    <div class="text-sm text-gray-600 font-romantic" id="syncStatusDesc">上次同步：刚刚</div>
                                </div>
                            </div>
                            <button onclick="syncData()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-300 font-love">
                                <i class="fa fa-heart mr-1"></i><span id="syncBtnText">立即同步</span>
                            </button>
                        </div>
                    </div>
                    
                    <!-- 统计卡片 -->
                    <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-gradient-to-br from-love to-pink-400 rounded-xl p-4 text-white text-center animate-scale-in">
                            <div class="text-2xl font-bold font-love" id="statPhotosCount">128</div>
                            <div class="text-sm opacity-90 font-romantic" id="statPhotosLabel">张甜蜜照片</div>
                        </div>
                        <div class="bg-gradient-to-br from-purple-400 to-pink-400 rounded-xl p-4 text-white text-center animate-scale-in">
                            <div class="text-2xl font-bold font-love" id="statVoicesCount">24</div>
                            <div class="text-sm opacity-90 font-romantic" id="statVoicesLabel">条爱的告白</div>
                        </div>
                        <div class="bg-gradient-to-br from-blue-400 to-pink-400 rounded-xl p-4 text-white text-center animate-scale-in">
                            <div class="text-2xl font-bold font-love" id="statDiariesCount">48</div>
                            <div class="text-sm opacity-90 font-romantic" id="statDiariesLabel">篇爱情日记</div>
                        </div>
                        <div class="bg-gradient-to-br from-green-400 to-pink-400 rounded-xl p-4 text-white text-center animate-scale-in">
                            <div class="text-2xl font-bold font-love" id="statMessagesCount">96</div>
                            <div class="text-sm opacity-90 font-romantic" id="statMessagesLabel">条甜蜜留言</div>
                        </div>
                    </div>
                    
                    <!-- 快速导航 -->
                    <div class="grid grid-cols-2 md:grid-cols-3 gap-4">
                        <button onclick="openModule('photos')" class="bg-gradient-to-r from-sweet to-warm rounded-xl p-4 text-center hover:scale-105 transition-transform duration-300 animate-fade-in">
                            <i class="fa fa-camera text-love text-2xl mb-2"></i>
                            <div class="font-semibold love-text font-love" id="navPhotos">甜蜜相册</div>
                        </button>
                        <button onclick="openModule('voices')" class="bg-gradient-to-r from-sweet to-warm rounded-xl p-4 text-center hover:scale-105 transition-transform duration-300 animate-fade-in">
                            <i class="fa fa-music text-love text-2xl mb-2"></i>
                            <div class="font-semibold love-text font-love" id="navVoices">爱的告白</div>
                        </button>
                        <button onclick="openModule('diary')" class="bg-gradient-to-r from-sweet to-warm rounded-xl p-4 text-center hover:scale-105 transition-transform duration-300 animate-fade-in">
                            <i class="fa fa-book text-love text-2xl mb-2"></i>
                            <div class="font-semibold love-text font-love" id="navDiary">爱情日记</div>
                        </button>
                        <button onclick="openModule('messages')" class="bg-gradient-to-r from-sweet to-warm rounded-xl p-4 text-center hover:scale-105 transition-transform duration-300 animate-fade-in">
                            <i class="fa fa-heart text-love text-2xl mb-2 heart-icon"></i>
                            <div class="font-semibold love-text font-love" id="navMessages">甜蜜留言</div>
                        </button>
                        <button onclick="openModule('dates')" class="bg-gradient-to-r from-sweet to-warm rounded-xl p-4 text-center hover:scale-105 transition-transform duration-300 animate-fade-in">
                            <i class="fa fa-calendar text-love text-2xl mb-2"></i>
                            <div class="font-semibold love-text font-love" id="navDates">重要纪念日</div>
                        </button>
                        <button onclick="exportData()" class="bg-gradient-to-r from-sweet to-warm rounded-xl p-4 text-center hover:scale-105 transition-transform duration-300 animate-fade-in">
                            <i class="fa fa-download text-love text-2xl mb-2"></i>
                            <div class="font-semibold love-text font-love" id="navExport">导出回忆</div>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 设置模块 -->
    <div id="settingsModal" class="fixed inset-0 z-50 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-4xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-2xl font-bold love-text font-love">
                        <i class="fa fa-cog text-love mr-3"></i><span id="settingsTitle">爱情设置</span>
                    </h3>
                    <button onclick="closeModule('settings')" class="text-gray-400 hover:text-love transition-colors duration-300">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                <div class="p-6 overflow-y-auto max-h-[calc(90vh-120px)] custom-scrollbar">
                    
                    <!-- GitHub同步设置 -->
                    <div class="bg-gradient-to-r from-blue-50 to-indigo-50 rounded-xl p-6 mb-6 border border-blue-200 animate-fade-in">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 font-love" id="githubSyncTitle">云端同步设置</h4>
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="githubTokenLabel">GitHub个人访问令牌</label>
                                <input type="password" id="githubToken" placeholder="请输入GitHub个人访问令牌" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 font-love">
                                <p class="text-xs text-gray-500 mt-1 font-romantic" id="githubTokenDesc">需要repo权限，用于同步我们的爱情数据</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="githubRepoLabel">仓库名称</label>
                                <input type="text" id="githubRepo" placeholder="username/repo-name" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 font-love">
                                <p class="text-xs text-gray-500 mt-1 font-romantic" id="githubRepoDesc">格式：用户名/仓库名，如：user/love-memories</p>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="githubBranchLabel">分支名称</label>
                                <input type="text" id="githubBranch" value="main" placeholder="分支名称" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 font-love">
                            </div>
                            <button onclick="testGitHubConnection()" class="bg-blue-500 hover:bg-blue-600 text-white px-6 py-2 rounded-lg transition-colors duration-300 font-love">
                                <i class="fa fa-heart mr-2"></i><span id="testConnectionBtn">测试连接</span>
                            </button>
                        </div>
                    </div>

                    <!-- 恋爱时间设置 -->
                    <div class="bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl p-6 mb-6 border border-pink-200 animate-slide-up">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 font-love" id="loveTimeSettingsTitle">我们的恋爱时间</h4>
                        <div class="space-y-4">
                            <div class="flex items-center justify-between p-4 bg-white rounded-xl">
                                <div>
                                    <div class="font-medium text-gray-800 font-love" id="currentLoveTimeTitle">我们相爱了</div>
                                    <div class="text-sm text-gray-600 font-romantic" id="currentLoveTimeValue">
                                        <span id="loveTimeDisplay">0 天 0 时 0 分 0 秒</span>
                                    </div>
                                </div>
                                <button onclick="resetLoveTime()" class="bg-love hover:bg-pink-600 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-300 font-love">
                                    <i class="fa fa-heart mr-2"></i><span id="resetLoveTimeBtn">重新开始</span>
                                </button>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="manualStartTimeLabel">手动设置开始时间</label>
                                <input type="datetime-local" id="manualStartTime" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-love font-love">
                                <button onclick="setManualLoveTime()" class="mt-2 bg-love hover:bg-pink-600 text-white px-4 py-2 rounded-lg text-sm transition-colors duration-300 font-love">
                                    <i class="fa fa-heart mr-2"></i><span id="saveStartTimeBtn">保存这个特殊时刻</span>
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- 文字自定义设置 -->
                    <div class="bg-gradient-to-r from-pink-50 to-rose-50 rounded-xl p-6 mb-6 border border-pink-200 animate-slide-up">
                        <h4 class="text-lg font-semibold text-gray-800 mb-4 font-love" id="customTextTitle">个性化文字</h4>
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="siteTitleLabel">网站标题</label>
                                <input type="text" id="customSiteTitle" placeholder="给我们的小站起个名字..." class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-love font-love">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="welcomeTitleLabel">欢迎语</label>
                                <input type="text" id="customWelcomeTitle" placeholder="想对她说的话..." class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-love font-love">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="welcomeSubtitleLabel">副标题</label>
                                <textarea id="customWelcomeSubtitle" placeholder="对我们爱情的描述..." rows="2" class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-love font-romantic"></textarea>
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-2 font-romantic" id="loveTimeLabelLabel">恋爱时间标签</label>
                                <input type="text" id="customLoveTimeLabel" placeholder="比如：我们相爱了..." class="w-full p-3 border border-gray-300 rounded-xl focus:outline-none focus:ring-2 focus:ring-love font-love">
                            </div>
                        </div>
                    </div>

                    <!-- 保存设置 -->
                    <div class="text-center animate-fade-in">
                        <button onclick="saveSettings()" class="bg-love hover:bg-pink-600 text-white px-8 py-3 rounded-xl font-semibold transition-all duration-300 transform hover:scale-105 font-love">
                            <i class="fa fa-heart mr-2 heart-icon"></i><span id="saveSettingsBtn">保存我们的设置</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 照片查看器 -->
    <div id="photoViewer" class="fixed inset-0 z-60 hidden modal-backdrop">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="bg-white rounded-3xl max-w-5xl w-full max-h-[90vh] overflow-hidden animate-scale-in">
                <div class="flex items-center justify-between p-6 border-b border-gray-100">
                    <h3 class="text-xl font-bold love-text font-love" id="photoViewerTitle">甜蜜回忆</h3>
                    <div class="flex items-center space-x-4">
                        <button onclick="previousPhoto()" class="text-gray-400 hover:text-love transition-colors duration-300">
                            <i class="fa fa-chevron-left"></i>
                        </button>
                        <button onclick="nextPhoto()" class="text-gray-400 hover:text-love transition-colors duration-300">
                            <i class="fa fa-chevron-right"></i>
                        </button>
                        <button onclick="closePhotoViewer()" class="text-gray-400 hover:text-love transition-colors duration-300">
                            <i class="fa fa-times text-xl"></i>
                        </button>
                    </div>
                </div>
                <div class="p-6 text-center">
                    <img id="viewerImage" src="" alt="" class="max-w-full max-h-[50vh] object-contain mx-auto rounded-xl photo-frame mb-4">
                    <p id="photoViewerDescription" class="text-gray-700 mb-4 font-romantic"></p>
                    <div class="flex items-center justify-center space-x-6 text-sm text-gray-600 font-romantic">
                        <span id="photoViewerDate"></span>
                        <span id="photoViewerSize"></span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // 全局变量
        let loveStartTime = null;
        let currentModule = null;
        let currentPhotoIndex = 0;
        let photos = [];
        let voices = [];
        let diaries = [];
        let messages = [];
        let importantDates = [];
        let isSyncing = false;

        // 应用设置
        let appSettings = {
            github: {
                token: '',
                repo: '',
                branch: 'main'
            },
            customTexts: {
                siteTitle: '致我最爱的你',
                welcomeTitle: '亲爱的，有你真好',
                welcomeSubtitle: '每一天都想告诉你，你是我生命中最美的礼物，我们的爱情故事还在继续...',
                loveTimeLabel: '我们相爱了',
                loveTimeDesc: '每一分每一秒都值得珍藏',
                startLoveTime: '开始记录我们的爱情时光',
                modulePhotos: '甜蜜相册',
                modulePhotosDesc: '记录我们的每一个美好瞬间',
                enterPhotos: '查看回忆',
                moduleVoices: '爱的告白',
                moduleVoicesDesc: '留下想对你说的悄悄话',
                enterVoices: '聆听心声',
                moduleDiary: '爱情日记',
                moduleDiaryDesc: '写下我们的爱情故事',
                enterDiary: '记录点滴',
                moduleMessages: '甜蜜留言',
                moduleMessagesDesc: '想对你说的话都在这里',
                enterMessages: '写留言',
                moduleDates: '重要纪念日',
                moduleDatesDesc: '记录我们的特殊日子',
                enterDates: '查看日历',
                moduleAlbum: '爱情统计',
                moduleAlbumDesc: '我们的爱情数据',
                enterAlbum: '查看统计',
                recentMessagesTitle: '最近的甜蜜留言',
                footerTitle: '致我最爱的你',
                footerSubtitle: '愿我们的爱情永远甜蜜如初',
                footerMadeWith: '用❤️制作',
                footerForever: '永远在一起'
            }
        };

        // 统计数据
        const stats = {
            photos: 0,
            voices: 0,
            diaries: 0,
            messages: 0
        };

        // DOM 元素
        const elements = {
            // 导航栏
            siteTitle: document.getElementById('siteTitle'),
            syncBtn: document.getElementById('syncBtn'),
            syncBadge: document.getElementById('syncBadge'),
            settingsBtn: document.getElementById('settingsBtn'),
            
            // 欢迎区域
            welcomeTitle: document.getElementById('welcomeTitle'),
            welcomeSubtitle: document.getElementById('welcomeSubtitle'),
            loveTimeLabel: document.getElementById('loveTimeLabel'),
            loveTime: document.getElementById('loveTime'),
            loveTimeDesc: document.getElementById('loveTimeDesc'),
            startLoveBtn: document.getElementById('startLoveBtn'),
            
            // 模块标题
            modulePhotos: document.getElementById('modulePhotos'),
            modulePhotosDesc: document.getElementById('modulePhotosDesc'),
            enterPhotos: document.getElementById('enterPhotos'),
            moduleVoices: document.getElementById('moduleVoices'),
            moduleVoicesDesc: document.getElementById('moduleVoicesDesc'),
            enterVoices: document.getElementById('enterVoices'),
            moduleDiary: document.getElementById('moduleDiary'),
            moduleDiaryDesc: document.getElementById('moduleDiaryDesc'),
            enterDiary: document.getElementById('enterDiary'),
            moduleMessages: document.getElementById('moduleMessages'),
            moduleMessagesDesc: document.getElementById('moduleMessagesDesc'),
            enterMessages: document.getElementById('enterMessages'),
            moduleDates: document.getElementById('moduleDates'),
            moduleDatesDesc: document.getElementById('moduleDatesDesc'),
            enterDates: document.getElementById('enterDates'),
            moduleAlbum: document.getElementById('moduleAlbum'),
            moduleAlbumDesc: document.getElementById('moduleAlbumDesc'),
            enterAlbum: document.getElementById('enterAlbum'),
            
            // 最近留言
            recentMessagesTitle: document.getElementById('recentMessagesTitle'),
            
            // 底部
            footerTitle: document.getElementById('footerTitle'),
            footerSubtitle: document.getElementById('footerSubtitle'),
            footerMadeWith: document.getElementById('footerMadeWith'),
            footerForever: document.getElementById('footerForever'),
            
            // 文件上传
            photoInput: document.getElementById('photoInput'),
            voiceInput: document.getElementById('voiceInput'),
            
            // 照片查看器
            photoViewer: document.getElementById('photoViewer'),
            viewerImage: document.getElementById('viewerImage'),
            photoViewerTitle: document.getElementById('photoViewerTitle'),
            photoViewerDescription: document.getElementById('photoViewerDescription'),
            photoViewerDate: document.getElementById('photoViewerDate'),
            photoViewerSize: document.getElementById('photoViewerSize')
        };

        // 初始化
        function init() {
            loadAllData();
            setupEventListeners();
            updateDiaryDate();
            updateLoveTime();
            updateStats();
            updateCustomTexts();
            updateRecentMessages();
            
            // 每秒更新一次恋爱时间
            setInterval(updateLoveTime, 1000);
            
            // 每分钟自动同步
            setInterval(autoSync, 60000);
            
            // 初始化示例数据
            initSampleData();
            
            // 添加页面加载动画
            setTimeout(() => {
                document.body.classList.add('animate-fade-in');
            }, 100);
        }

        // 设置事件监听器
        function setupEventListeners() {
            // 同步按钮
            elements.syncBtn.addEventListener('click', syncData);
            
            // 设置按钮
            elements.settingsBtn.addEventListener('click', () => openModule('settings'));
            
            // 恋爱时间
            elements.startLoveBtn.addEventListener('click', startLoveTime);
            
            // 文件上传
            elements.photoInput.addEventListener('change', handlePhotoUpload);
            elements.voiceInput.addEventListener('change', handleVoiceUpload);
            
            // 点击模态框背景关闭
            document.querySelectorAll('.modal-backdrop').forEach(modal => {
                modal.addEventListener('click', function(e) {
                    if (e.target === this) {
                        const modalId = this.id;
                        const moduleName = modalId.replace('Modal', '');
                        closeModule(moduleName.toLowerCase());
                    }
                });
            });
            
            // 键盘事件
            document.addEventListener('keydown', function(e) {
                if (e.key === 'Escape') {
                    closeAllModules();
                    closePhotoViewer();
                }
                if (!elements.photoViewer.classList.contains('hidden')) {
                    if (e.key === 'ArrowLeft') previousPhoto();
                    if (e.key === 'ArrowRight') nextPhoto();
                }
            });
            
            // 页面滚动效果
            window.addEventListener('scroll', function() {
                const scrolled = window.pageYOffset;
                const parallax = document.querySelectorAll('.floating-heart');
                const speed = 0.5;
                
                parallax.forEach((heart, index) => {
                    const yPos = -(scrolled * speed);
                    heart.style.transform = `translateY(${yPos}px)`;
                });
            });
        }

        // 打开模块
        function openModule(moduleName) {
            closeAllModules();
            currentModule = moduleName;
            
            const modal = document.getElementById(moduleName + 'Modal');
            if (modal) {
                modal.classList.remove('hidden');
                document.body.style.overflow = 'hidden';
                
                // 如果是设置模块，加载当前设置
                if (moduleName === 'settings') {
                    loadSettingsToForm();
                    updateLoveTimeDisplayInSettings();
                }
            }
        }

        // 关闭模块
        function closeModule(moduleName) {
            const modal = document.getElementById(moduleName + 'Modal');
            if (modal) {
                modal.classList.add('hidden');
                document.body.style.overflow = 'auto';
            }
            currentModule = null;
        }

        // 关闭所有模块
        function closeAllModules() {
            document.querySelectorAll('[id$="Modal"]').forEach(modal => {
                modal.classList.add('hidden');
            });
            document.body.style.overflow = 'auto';
            currentModule = null;
        }

        // 开始记录恋爱时间
        function startLoveTime() {
            loveStartTime = new Date();
            saveData();
            elements.startLoveBtn.innerHTML = '<i class="fa fa-heart mr-2"></i>' + (appSettings.customTexts.restartLoveTime || '重新开始记录');
            elements.startLoveBtn.onclick = resetLoveTime;
            updateLoveTime();
            showNotification('我们的爱情记录已开始！', 'success');
        }

        // 重置恋爱时间
        function resetLoveTime() {
            if (confirm('确定要重新开始记录我们的爱情时间吗？')) {
                loveStartTime = null;
                saveData();
                elements.startLoveBtn.innerHTML = '<i class="fa fa-heart mr-2"></i>' + (appSettings.customTexts.startLoveTime || '开始记录我们的爱情时光');
                elements.startLoveBtn.onclick = startLoveTime;
                updateLoveTime();
                if (currentModule === 'settings') {
                    updateLoveTimeDisplayInSettings();
                }
            }
        }

        // 手动设置恋爱开始时间
        function setManualLoveTime() {
            const datetime = document.getElementById('manualStartTime').value;
            if (!datetime) {
                alert('请选择我们开始相爱的特殊时刻！');
                return;
            }
            
            loveStartTime = new Date(datetime);
            saveData();
            elements.startLoveBtn.innerHTML = '<i class="fa fa-heart mr-2"></i>' + (appSettings.customTexts.restartLoveTime || '重新开始记录');
            elements.startLoveBtn.onclick = resetLoveTime;
            updateLoveTime();
            updateLoveTimeDisplayInSettings();
            showNotification('我们的爱情开始时间已设置！', 'success');
        }

        // 更新恋爱时间显示
        function updateLoveTime() {
            if (!loveStartTime) {
                elements.loveTime.textContent = '0 天 0 时 0 分 0 秒';
                return;
            }
            
            const now = new Date();
            const diff = now - loveStartTime;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            elements.loveTime.textContent = `${days} 天 ${hours} 时 ${minutes} 分 ${seconds} 秒`;
            
            // 如果设置页面打开，也更新那里的显示
            if (currentModule === 'settings') {
                updateLoveTimeDisplayInSettings();
            }
        }

        // 在设置页面中更新恋爱时间显示
        function updateLoveTimeDisplayInSettings() {
            const displayElement = document.getElementById('loveTimeDisplay');
            if (!displayElement) return;
            
            if (!loveStartTime) {
                displayElement.textContent = '0 天 0 时 0 分 0 秒';
                return;
            }
            
            const now = new Date();
            const diff = now - loveStartTime;
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            displayElement.textContent = `${days} 天 ${hours} 时 ${minutes} 分 ${seconds} 秒`;
        }

        // 处理照片上传
        function handlePhotoUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photo = {
                        id: Date.now(),
                        url: e.target.result,
                        name: file.name,
                        size: file.size,
                        date: new Date(),
                        description: ''
                    };
                    
                    addPhoto(photo);
                    stats.photos++;
                    updateStats();
                    saveData();
                    showNotification('甜蜜照片上传成功！', 'success');
                };
                reader.readAsDataURL(file);
            });
            
            // 清空文件输入
            elements.photoInput.value = '';
        }

        // 添加照片
        function addPhoto(photo) {
            photos.push(photo);
            
            const photosGrid = document.getElementById('photosGrid');
            const photoItem = createPhotoItem(photo);
            photosGrid.insertBefore(photoItem, photosGrid.firstChild);
        }

        // 创建照片项
        function createPhotoItem(photo) {
            const item = document.createElement('div');
            item.className = 'photo-item bg-gray-100 rounded-xl overflow-hidden hover:scale-105 transition-transform duration-300 cursor-pointer relative photo-frame';
            item.onclick = () => openPhotoViewer(photo);
            
            const dateStr = photo.date.toLocaleDateString('zh-CN');
            const sizeStr = formatFileSize(photo.size);
            
            item.innerHTML = `
                <img src="${photo.url}" alt="${photo.name}" class="w-full h-32 object-cover">
                <div class="p-2 text-xs text-gray-600 font-love">${photo.name}</div>
                <button onclick="event.stopPropagation(); deletePhoto(${photo.id})" class="delete-btn-love absolute top-1 right-1 w-6 h-6 bg-red-500 text-white text-xs rounded-full flex items-center justify-center opacity-70 hover:opacity-100">
                    <i class="fa fa-trash"></i>
                </button>
            `;
            
            return item;
        }

        // 删除照片
        function deletePhoto(id) {
            if (confirm('确定要删除这张甜蜜照片吗？')) {
                const index = photos.findIndex(photo => photo.id === id);
                if (index !== -1) {
                    photos.splice(index, 1);
                    stats.photos--;
                    updateStats();
                    saveData();
                    
                    // 移除DOM元素
                    const photoItems = document.querySelectorAll('.photo-item');
                    photoItems.forEach((item, i) => {
                        if (i === index) {
                            item.remove();
                        }
                    });
                    
                    showNotification('照片删除成功！', 'success');
                }
            }
        }

        // 打开照片查看器
        function openPhotoViewer(photo) {
            currentPhotoIndex = photos.findIndex(p => p.id === photo.id);
            
            elements.viewerImage.src = photo.url;
            elements.photoViewerTitle.textContent = photo.name;
            elements.photoViewerDescription.textContent = photo.description || '这是我们的甜蜜回忆';
            elements.photoViewerDate.textContent = '拍摄时间：' + photo.date.toLocaleString('zh-CN');
            elements.photoViewerSize.textContent = '大小：' + formatFileSize(photo.size);
            
            elements.photoViewer.classList.remove('hidden');
            document.body.style.overflow = 'hidden';
        }

        // 关闭照片查看器
        function closePhotoViewer() {
            elements.photoViewer.classList.add('hidden');
            document.body.style.overflow = 'auto';
        }

        // 上一张照片
        function previousPhoto() {
            if (photos.length === 0) return;
            currentPhotoIndex = (currentPhotoIndex - 1 + photos.length) % photos.length;
            const photo = photos[currentPhotoIndex];
            openPhotoViewer(photo);
        }

        // 下一张照片
        function nextPhoto() {
            if (photos.length === 0) return;
            currentPhotoIndex = (currentPhotoIndex + 1) % photos.length;
            const photo = photos[currentPhotoIndex];
            openPhotoViewer(photo);
        }

        // 处理语音上传
        function handleVoiceUpload(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            Array.from(files).forEach(file => {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const voice = {
                        id: Date.now(),
                        url: e.target.result,
                        name: file.name,
                        size: file.size,
                        date: new Date(),
                        duration: 0
                    };
                    
                    addVoice(voice);
                    stats.voices++;
                    updateStats();
                    saveData();
                    showNotification('爱的告白上传成功！', 'success');
                };
                reader.readAsDataURL(file);
            });
            
            // 清空文件输入
            elements.voiceInput.value = '';
        }

        // 添加语音
        function addVoice(voice) {
            voices.push(voice);
            
            const voicesList = document.getElementById('voicesList');
            const voiceItem = createVoiceItem(voice);
            voicesList.insertBefore(voiceItem, voicesList.firstChild);
        }

        // 创建语音项
        function createVoiceItem(voice) {
            const item = document.createElement('div');
            item.className = 'voice-item bg-gradient-to-r from-sweet to-warm rounded-xl p-4 flex items-center justify-between animate-slide-up';
            
            const dateStr = voice.date.toLocaleDateString('zh-CN');
            const sizeStr = formatFileSize(voice.size);
            const durationStr = voice.duration > 0 ? `${voice.duration}秒` : '未知时长';
            
            item.innerHTML = `
                <div class="flex items-center space-x-4">
                    <div class="w-14 h-14 bg-love rounded-full flex items-center justify-center">
                        <i class="fa fa-heart text-white text-xl"></i>
                    </div>
                    <div>
                        <h4 class="font-semibold love-text font-love truncate">${voice.name}</h4>
                        <p class="text-gray-600 text-sm font-romantic">${dateStr} · ${durationStr} · ${sizeStr}</p>
                    </div>
                </div>
                <div class="flex items-center space-x-2">
                    <button class="text-love hover:text-pink-600 transition-colors duration-300" onclick="playVoice(this, '${voice.url}')">
                        <i class="fa fa-play-circle text-2xl"></i>
                    </button>
                    <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300" onclick="deleteVoice(${voice.id})">
                        <i class="fa fa-trash text-xl"></i>
                    </button>
                </div>
            `;
            
            return item;
        }

        // 删除语音
        function deleteVoice(id) {
            if (confirm('确定要删除这条爱的告白吗？')) {
                const index = voices.findIndex(voice => voice.id === id);
                if (index !== -1) {
                    voices.splice(index, 1);
                    stats.voices--;
                    updateStats();
                    saveData();
                    
                    // 移除DOM元素
                    const voiceItems = document.querySelectorAll('.voice-item');
                    voiceItems.forEach((item, i) => {
                        if (i === index) {
                            item.remove();
                        }
                    });
                    
                    showNotification('语音删除成功！', 'success');
                }
            }
        }

        // 播放语音
        function playVoice(button, url) {
            const icon = button.querySelector('i');
            if (icon.classList.contains('fa-play-circle')) {
                // 停止其他所有播放
                document.querySelectorAll('.voice-item button i').forEach(i => {
                    if (i.classList.contains('fa-pause-circle')) {
                        i.classList.remove('fa-pause-circle');
                        i.classList.add('fa-play-circle');
                    }
                });
                
                // 开始播放
                icon.classList.remove('fa-play-circle');
                icon.classList.add('fa-pause-circle');
                
                // 这里可以添加实际的音频播放逻辑
                const audio = new Audio(url);
                audio.play();
                audio.onended = () => {
                    icon.classList.remove('fa-pause-circle');
                    icon.classList.add('fa-play-circle');
                };
            } else {
                // 暂停播放
                icon.classList.remove('fa-pause-circle');
                icon.classList.add('fa-play-circle');
            }
        }

        // 保存日记
        function saveDiary() {
            const title = document.getElementById('newDiaryTitle').value.trim();
            const content = document.getElementById('newDiaryContent').value.trim();
            
            if (!title || !content) {
                alert('请填写标题和内容，记录我们的爱情故事！');
                return;
            }
            
            const diary = {
                id: Date.now(),
                title: title,
                content: content,
                date: new Date(),
                comments: []
            };
            
            addDiary(diary);
            stats.diaries++;
            updateStats();
            saveData();
            
            // 清空输入
            document.getElementById('newDiaryTitle').value = '';
            document.getElementById('newDiaryContent').value = '';
            
            showNotification('爱情日记保存成功！', 'success');
        }

        // 添加日记
        function addDiary(diary) {
            diaries.push(diary);
            
            const diaryList = document.getElementById('diaryList');
            const diaryItem = createDiaryItem(diary);
            diaryList.insertBefore(diaryItem, diaryList.firstChild);
        }

        // 创建日记项
        function createDiaryItem(diary) {
            const item = document.createElement('div');
            item.className = 'diary-item bg-gradient-to-r from-warm to-sweet rounded-xl p-6 animate-slide-up';
            
            const dateStr = diary.date.toLocaleDateString('zh-CN');
            const commentCount = diary.comments.length;
            
            item.innerHTML = `
                <div class="flex items-start justify-between mb-3">
                    <h4 class="font-semibold love-text font-love text-lg">${diary.title}</h4>
                    <span class="text-xs text-gray-600 font-romantic">${dateStr}</span>
                </div>
                <p class="text-gray-700 mb-4 font-romantic">${diary.content}</p>
                <div class="flex items-center justify-between">
                    <button class="text-love hover:text-pink-600 transition-colors duration-300 text-sm font-love">
                        <i class="fa fa-heart mr-1"></i>爱的回应 (${commentCount})
                    </button>
                    <div class="flex space-x-2">
                        <button class="text-gray-400 hover:text-love transition-colors duration-300">
                            <i class="fa fa-edit"></i>
                        </button>
                        <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300" onclick="deleteDiary(${diary.id})">
                            <i class="fa fa-trash"></i>
                        </button>
                    </div>
                </div>
            `;
            
            return item;
        }

        // 删除日记
        function deleteDiary(id) {
            if (confirm('确定要删除这篇爱情日记吗？')) {
                const index = diaries.findIndex(diary => diary.id === id);
                if (index !== -1) {
                    diaries.splice(index, 1);
                    stats.diaries--;
                    updateStats();
                    saveData();
                    
                    // 移除DOM元素
                    const diaryItems = document.querySelectorAll('.diary-item');
                    diaryItems.forEach((item, i) => {
                        if (i === index) {
                            item.remove();
                        }
                    });
                    
                    showNotification('日记删除成功！', 'success');
                }
            }
        }

        // 保存留言
        function saveMessage() {
            const content = document.getElementById('newMessage').value.trim();
            
            if (!content) {
                alert('请输入想对亲爱的说的话！');
                return;
            }
            
            const message = {
                id: Date.now(),
                content: content,
                sender: '我',
                date: new Date(),
                replies: []
            };
            
            addMessage(message);
            stats.messages++;
            updateStats();
            saveData();
            updateRecentMessages();
            
            // 清空输入
            document.getElementById('newMessage').value = '';
            
            showNotification('甜蜜留言发送成功！', 'success');
        }

        // 添加留言
        function addMessage(message) {
            messages.push(message);
            
            const messagesList = document.getElementById('messagesList');
            const messageItem = createMessageItem(message);
            messagesList.insertBefore(messageItem, messagesList.firstChild);
        }

        // 创建留言项
        function createMessageItem(message) {
            const item = document.createElement('div');
            item.className = 'message-bubble p-4 animate-slide-up';
            
            const timeStr = formatRelativeTime(message.date);
            
            item.innerHTML = `
                <div class="flex items-start space-x-3">
                    <div class="w-8 h-8 bg-love rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white text-xs font-bold font-love">${message.sender.charAt(0)}</span>
                    </div>
                    <div class="flex-1">
                        <div class="flex items-center justify-between mb-1">
                            <div class="flex items-center space-x-2">
                                <span class="font-semibold love-text font-love text-sm">${message.sender}</span>
                                <span class="text-xs text-gray-600 font-romantic">${timeStr}</span>
                            </div>
                            <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300" onclick="deleteMessage(${message.id})">
                                <i class="fa fa-trash text-sm"></i>
                            </button>
                        </div>
                        <p class="text-gray-700 text-sm mb-2 font-romantic">${message.content}</p>
                        <button class="text-love hover:text-pink-600 transition-colors duration-300 text-xs font-love">
                            <i class="fa fa-heart mr-1"></i>爱的回应
                        </button>
                    </div>
                </div>
            `;
            
            return item;
        }

        // 删除留言
        function deleteMessage(id) {
            if (confirm('确定要删除这条甜蜜留言吗？')) {
                const index = messages.findIndex(message => message.id === id);
                if (index !== -1) {
                    messages.splice(index, 1);
                    stats.messages--;
                    updateStats();
                    saveData();
                    updateRecentMessages();
                    
                    // 移除DOM元素
                    const messageItems = document.querySelectorAll('.message-bubble');
                    messageItems.forEach((item, i) => {
                        if (i === index) {
                            item.remove();
                        }
                    });
                    
                    showNotification('留言删除成功！', 'success');
                }
            }
        }

        // 更新最近留言
        function updateRecentMessages() {
            const recentMessagesList = document.getElementById('recentMessagesList');
            if (!recentMessagesList) return;
            
            // 清空现有内容
            recentMessagesList.innerHTML = '';
            
            // 显示最近的3条留言
            const recentMessages = [...messages].sort((a, b) => b.date - a.date).slice(0, 3);
            
            if (recentMessages.length === 0) {
                recentMessagesList.innerHTML = `
                    <div class="text-center text-gray-500 py-8 font-romantic">
                        <i class="fa fa-heart text-3xl text-love/30 mb-4"></i>
                        <p>还没有甜蜜留言呢，快去给亲爱的写一句吧！</p>
                    </div>
                `;
                return;
            }
            
            recentMessages.forEach(message => {
                const messageItem = createMessageItem(message);
                recentMessagesList.appendChild(messageItem);
            });
        }

        // 保存重要日期
        function saveDate() {
            const date = document.getElementById('newDate').value;
            const title = document.getElementById('newDateTitle').value.trim();
            const description = document.getElementById('newDateDescription').value.trim();
            
            if (!date || !title) {
                alert('请填写日期和标题，记录我们的特殊日子！');
                return;
            }
            
            const importantDate = {
                id: Date.now(),
                date: new Date(date),
                title: title,
                description: description
            };
            
            addDate(importantDate);
            saveData();
            
            // 清空输入
            document.getElementById('newDate').value = '';
            document.getElementById('newDateTitle').value = '';
            document.getElementById('newDateDescription').value = '';
            
            showNotification('重要纪念日添加成功！', 'success');
        }

        // 添加重要日期
        function addDate(date) {
            importantDates.push(date);
            
            const datesList = document.getElementById('datesList');
            const dateItem = createDateItem(date);
            datesList.insertBefore(dateItem, datesList.firstChild);
        }

        // 创建日期项
        function createDateItem(date) {
            const item = document.createElement('div');
            item.className = 'date-item bg-gradient-to-r from-warm to-sweet rounded-xl p-4 animate-slide-up';
            
            const dateStr = date.date.toLocaleDateString('zh-CN');
            const now = new Date();
            const diffTime = Math.abs(now - date.date);
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));
            const status = now > date.date ? '已过去' : '还有';
            
            item.innerHTML = `
                <div class="flex items-start justify-between mb-2">
                    <h4 class="font-semibold love-text font-love">${date.title}</h4>
                    <div class="flex items-center space-x-2">
                        <span class="text-xs text-gray-600 font-romantic">${dateStr}</span>
                        <button class="delete-btn-love text-gray-400 hover:text-red-500 transition-colors duration-300" onclick="deleteDate(${date.id})">
                            <i class="fa fa-trash text-sm"></i>
                        </button>
                    </div>
                </div>
                <p class="text-gray-700 text-sm mb-2 font-romantic">${date.description || '这是我们的特殊日子'}</p>
                <div class="text-love text-sm font-medium font-love">
                    <i class="fa fa-heart mr-1 heart-icon"></i>${status} ${diffDays} 天
                </div>
            `;
            
            return item;
        }

        // 删除重要日期
        function deleteDate(id) {
            if (confirm('确定要删除这个重要纪念日吗？')) {
                const index = importantDates.findIndex(date => date.id === id);
                if (index !== -1) {
                    importantDates.splice(index, 1);
                    saveData();
                    
                    // 移除DOM元素
                    const dateItems = document.querySelectorAll('.date-item');
                    dateItems.forEach((item, i) => {
                        if (i === index) {
                            item.remove();
                        }
                    });
                    
                    showNotification('重要日期删除成功！', 'success');
                }
            }
        }

        // 更新日记日期
        function updateDiaryDate() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN', {
                year: 'numeric',
                month: 'long',
                day: 'numeric',
                weekday: 'long'
            });
            const diaryDateElement = document.getElementById('diaryDate');
            if (diaryDateElement) {
                diaryDateElement.textContent = dateStr;
            }
        }

        // 更新统计数据
        function updateStats() {
            // 更新首页统计
            const photoCountElement = document.getElementById('statPhotosCount');
            const voiceCountElement = document.getElementById('statVoicesCount');
            const diaryCountElement = document.getElementById('statDiariesCount');
            const messageCountElement = document.getElementById('statMessagesCount');
            
            if (photoCountElement) photoCountElement.textContent = stats.photos;
            if (voiceCountElement) voiceCountElement.textContent = stats.voices;
            if (diaryCountElement) diaryCountElement.textContent = stats.diaries;
            if (messageCountElement) messageCountElement.textContent = stats.messages;
        }

        // 更新自定义文字
        function updateCustomTexts() {
            // 导航栏
            if (elements.siteTitle) elements.siteTitle.textContent = appSettings.customTexts.siteTitle;
            
            // 欢迎区域
            if (elements.welcomeTitle) elements.welcomeTitle.textContent = appSettings.customTexts.welcomeTitle;
            if (elements.welcomeSubtitle) elements.welcomeSubtitle.textContent = appSettings.customTexts.welcomeSubtitle;
            if (elements.loveTimeLabel) elements.loveTimeLabel.textContent = appSettings.customTexts.loveTimeLabel;
            if (elements.loveTimeDesc) elements.loveTimeDesc.textContent = appSettings.customTexts.loveTimeDesc;
            if (elements.startLoveBtn) {
                elements.startLoveBtn.innerHTML = loveStartTime 
                    ? '<i class="fa fa-heart mr-2"></i>' + (appSettings.customTexts.restartLoveTime || '重新开始记录')
                    : '<i class="fa fa-heart mr-2"></i>' + (appSettings.customTexts.startLoveTime || '开始记录我们的爱情时光');
            }
            
            // 模块标题
            if (elements.modulePhotos) elements.modulePhotos.textContent = appSettings.customTexts.modulePhotos;
            if (elements.modulePhotosDesc) elements.modulePhotosDesc.textContent = appSettings.customTexts.modulePhotosDesc;
            if (elements.enterPhotos) elements.enterPhotos.textContent = appSettings.customTexts.enterPhotos;
            if (elements.moduleVoices) elements.moduleVoices.textContent = appSettings.customTexts.moduleVoices;
            if (elements.moduleVoicesDesc) elements.moduleVoicesDesc.textContent = appSettings.customTexts.moduleVoicesDesc;
            if (elements.enterVoices) elements.enterVoices.textContent = appSettings.customTexts.enterVoices;
            if (elements.moduleDiary) elements.moduleDiary.textContent = appSettings.customTexts.moduleDiary;
            if (elements.moduleDiaryDesc) elements.moduleDiaryDesc.textContent = appSettings.customTexts.moduleDiaryDesc;
            if (elements.enterDiary) elements.enterDiary.textContent = appSettings.customTexts.enterDiary;
            if (elements.moduleMessages) elements.moduleMessages.textContent = appSettings.customTexts.moduleMessages;
            if (elements.moduleMessagesDesc) elements.moduleMessagesDesc.textContent = appSettings.customTexts.moduleMessagesDesc;
            if (elements.enterMessages) elements.enterMessages.textContent = appSettings.customTexts.enterMessages;
            if (elements.moduleDates) elements.moduleDates.textContent = appSettings.customTexts.moduleDates;
            if (elements.moduleDatesDesc) elements.moduleDatesDesc.textContent = appSettings.customTexts.moduleDatesDesc;
            if (elements.enterDates) elements.enterDates.textContent = appSettings.customTexts.enterDates;
            if (elements.moduleAlbum) elements.moduleAlbum.textContent = appSettings.customTexts.moduleAlbum;
            if (elements.moduleAlbumDesc) elements.moduleAlbumDesc.textContent = appSettings.customTexts.moduleAlbumDesc;
            if (elements.enterAlbum) elements.enterAlbum.textContent = appSettings.customTexts.enterAlbum;
            
            // 最近留言
            if (elements.recentMessagesTitle) elements.recentMessagesTitle.innerHTML = '<i class="fa fa-heart mr-2 heart-icon"></i>' + appSettings.customTexts.recentMessagesTitle;
            
            // 底部
            if (elements.footerTitle) elements.footerTitle.textContent = appSettings.customTexts.footerTitle;
            if (elements.footerSubtitle) elements.footerSubtitle.textContent = appSettings.customTexts.footerSubtitle;
            if (elements.footerMadeWith) elements.footerMadeWith.textContent = appSettings.customTexts.footerMadeWith;
            if (elements.footerForever) elements.footerForever.textContent = appSettings.customTexts.footerForever;
        }

        // 加载设置到表单
        function loadSettingsToForm() {
            document.getElementById('githubToken').value = appSettings.github.token || '';
            document.getElementById('githubRepo').value = appSettings.github.repo || '';
            document.getElementById('githubBranch').value = appSettings.github.branch || 'main';
            
            document.getElementById('customSiteTitle').value = appSettings.customTexts.siteTitle || '';
            document.getElementById('customWelcomeTitle').value = appSettings.customTexts.welcomeTitle || '';
            document.getElementById('customWelcomeSubtitle').value = appSettings.customTexts.welcomeSubtitle || '';
            document.getElementById('customLoveTimeLabel').value = appSettings.customTexts.loveTimeLabel || '';
            
            // 设置手动开始时间
            if (loveStartTime) {
                const datetime = loveStartTime.toISOString().slice(0, 16);
                document.getElementById('manualStartTime').value = datetime;
            }
        }

        // 保存设置
        function saveSettings() {
            appSettings.github.token = document.getElementById('githubToken').value;
            appSettings.github.repo = document.getElementById('githubRepo').value;
            appSettings.github.branch = document.getElementById('githubBranch').value;
            
            appSettings.customTexts.siteTitle = document.getElementById('customSiteTitle').value || appSettings.customTexts.siteTitle;
            appSettings.customTexts.welcomeTitle = document.getElementById('customWelcomeTitle').value || appSettings.customTexts.welcomeTitle;
            appSettings.customTexts.welcomeSubtitle = document.getElementById('customWelcomeSubtitle').value || appSettings.customTexts.welcomeSubtitle;
            appSettings.customTexts.loveTimeLabel = document.getElementById('customLoveTimeLabel').value || appSettings.customTexts.loveTimeLabel;
            
            // 保存到本地存储
            localStorage.setItem('loveStationSettings', JSON.stringify(appSettings));
            
            // 更新界面
            updateCustomTexts();
            
            showNotification('我们的设置保存成功！', 'success');
            closeModule('settings');
        }

        // 测试GitHub连接
        async function testGitHubConnection() {
            const token = document.getElementById('githubToken').value;
            const repo = document.getElementById('githubRepo').value;
            
            if (!token || !repo) {
                alert('请填写GitHub令牌和仓库信息！');
                return;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                if (response.ok) {
                    showNotification('GitHub连接测试成功！我们的爱情数据可以同步了！', 'success');
                } else {
                    const error = await response.json();
                    showNotification(`连接失败: ${error.message}`, 'error');
                }
            } catch (error) {
                showNotification(`连接失败: ${error.message}`, 'error');
            }
        }

        // 同步数据到GitHub
        async function syncData() {
            if (isSyncing) {
                showNotification('正在同步我们的爱情数据，请稍候...', 'info');
                return;
            }
            
            const { token, repo, branch } = appSettings.github;
            
            if (!token || !repo || !branch) {
                showNotification('请先在设置中配置GitHub信息！', 'warning');
                openModule('settings');
                return;
            }
            
            isSyncing = true;
            elements.syncBtn.disabled = true;
            elements.syncBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i>';
            
            try {
                showNotification('开始同步我们的爱情回忆...', 'info');
                
                // 准备要同步的数据
                const syncData = {
                    loveStartTime: loveStartTime ? loveStartTime.toISOString() : null,
                    stats: stats,
                    photos: photos,
                    voices: voices,
                    diaries: diaries,
                    messages: messages,
                    importantDates: importantDates,
                    lastSync: new Date().toISOString()
                };
                
                const content = btoa(JSON.stringify(syncData, null, 2));
                const path = 'love-station-data.json';
                
                // 先检查文件是否存在
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/${path}?ref=${branch}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                let sha = null;
                if (response.ok) {
                    const data = await response.json();
                    sha = data.sha;
                }
                
                // 提交更新
                const updateResponse = await fetch(`https://api.github.com/repos/${repo}/contents/${path}`, {
                    method: 'PUT',
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        message: 'Sync our love memories ❤️',
                        content: content,
                        branch: branch,
                        sha: sha
                    })
                });
                
                if (updateResponse.ok) {
                    showNotification('我们的爱情数据同步成功！', 'success');
                    elements.syncBadge.classList.remove('hidden');
                    setTimeout(() => {
                        elements.syncBadge.classList.add('hidden');
                    }, 3000);
                } else {
                    const error = await updateResponse.json();
                    showNotification(`同步失败: ${error.message}`, 'error');
                }
            } catch (error) {
                showNotification(`同步失败: ${error.message}`, 'error');
            } finally {
                isSyncing = false;
                elements.syncBtn.disabled = false;
                elements.syncBtn.innerHTML = '<i class="fa fa-cloud"></i>';
            }
        }

        // 从GitHub拉取数据
        async function pullData() {
            const { token, repo, branch } = appSettings.github;
            
            if (!token || !repo || !branch) {
                return null;
            }
            
            try {
                const response = await fetch(`https://api.github.com/repos/${repo}/contents/love-station-data.json?ref=${branch}`, {
                    headers: {
                        'Authorization': `token ${token}`
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    const content = atob(data.content);
                    return JSON.parse(content);
                }
                
                return null;
            } catch (error) {
                console.error('拉取数据失败:', error);
                return null;
            }
        }

        // 自动同步
        async function autoSync() {
            if (appSettings.github.token && appSettings.github.repo && appSettings.github.branch) {
                try {
                    const remoteData = await pullData();
                    if (remoteData && (!window.lastSync || new Date(remoteData.lastSync) > new Date(window.lastSync))) {
                        // 有新数据，合并数据
                        mergeRemoteData(remoteData);
                        window.lastSync = remoteData.lastSync;
                        showNotification('我们的爱情数据自动同步完成！', 'success');
                    }
                } catch (error) {
                    console.error('自动同步失败:', error);
                }
            }
        }

        // 合并远程数据
        function mergeRemoteData(remoteData) {
            if (remoteData.loveStartTime) {
                loveStartTime = new Date(remoteData.loveStartTime);
            }
            
            if (remoteData.stats) {
                Object.assign(stats, remoteData.stats);
            }
            
            if (remoteData.photos) {
                // 合并照片数据
                remoteData.photos.forEach(remotePhoto => {
                    const existing = photos.find(p => p.id === remotePhoto.id);
                    if (!existing) {
                        photos.push(remotePhoto);
                        addPhoto(remotePhoto);
                    }
                });
            }
            
            if (remoteData.voices) {
                // 合并语音数据
                remoteData.voices.forEach(remoteVoice => {
                    const existing = voices.find(v => v.id === remoteVoice.id);
                    if (!existing) {
                        voices.push(remoteVoice);
                        addVoice(remoteVoice);
                    }
                });
            }
            
            if (remoteData.diaries) {
                // 合并日记数据
                remoteData.diaries.forEach(remoteDiary => {
                    const existing = diaries.find(d => d.id === remoteDiary.id);
                    if (!existing) {
                        diaries.push(remoteDiary);
                        addDiary(remoteDiary);
                    }
                });
            }
            
            if (remoteData.messages) {
                // 合并留言数据
                remoteData.messages.forEach(remoteMessage => {
                    const existing = messages.find(m => m.id === remoteMessage.id);
                    if (!existing) {
                        messages.push(remoteMessage);
                        addMessage(remoteMessage);
                    }
                });
            }
            
            if (remoteData.importantDates) {
                // 合并重要日期数据
                remoteData.importantDates.forEach(remoteDate => {
                    const existing = importantDates.find(d => d.id === remoteDate.id);
                    if (!existing) {
                        importantDates.push(remoteDate);
                        addDate(remoteDate);
                    }
                });
            }
            
            updateLoveTime();
            updateStats();
            updateRecentMessages();
            saveData();
        }

        // 导出数据
        function exportData() {
            const data = {
                loveStartTime: loveStartTime ? loveStartTime.toISOString() : null,
                stats: stats,
                photos: photos,
                voices: voices,
                diaries: diaries,
                messages: messages,
                importantDates: importantDates,
                appSettings: appSettings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `我们的爱情回忆_备份_${new Date().toISOString().slice(0, 10)}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            showNotification('我们的爱情回忆导出成功！', 'success');
        }

        // 保存所有数据到本地存储
        function saveData() {
            const data = {
                loveStartTime: loveStartTime ? loveStartTime.toISOString() : null,
                stats: stats,
                photos: photos,
                voices: voices,
                diaries: diaries,
                messages: messages,
                importantDates: importantDates
            };
            localStorage.setItem('loveStationData', JSON.stringify(data));
        }

        // 从本地存储加载所有数据
        function loadAllData() {
            // 加载主数据
            const data = JSON.parse(localStorage.getItem('loveStationData') || '{}');
            if (data.loveStartTime) {
                loveStartTime = new Date(data.loveStartTime);
                elements.startLoveBtn.innerHTML = '<i class="fa fa-heart mr-2"></i>' + (appSettings.customTexts.restartLoveTime || '重新开始记录');
                elements.startLoveBtn.onclick = resetLoveTime;
            }
            
            if (data.stats) {
                Object.assign(stats, data.stats);
            }
            
            if (data.photos) {
                photos = data.photos.map(photo => {
                    photo.date = new Date(photo.date);
                    return photo;
                });
                photos.forEach(photo => addPhoto(photo));
            }
            
            if (data.voices) {
                voices = data.voices.map(voice => {
                    voice.date = new Date(voice.date);
                    return voice;
                });
                voices.forEach(voice => addVoice(voice));
            }
            
            if (data.diaries) {
                diaries = data.diaries.map(diary => {
                    diary.date = new Date(diary.date);
                    return diary;
                });
                diaries.forEach(diary => addDiary(diary));
            }
            
            if (data.messages) {
                messages = data.messages.map(message => {
                    message.date = new Date(message.date);
                    return message;
                });
                messages.forEach(message => addMessage(message));
            }
            
            if (data.importantDates) {
                importantDates = data.importantDates.map(date => {
                    date.date = new Date(date.date);
                    return date;
                });
                importantDates.forEach(date => addDate(date));
            }
            
            // 加载设置
            const settings = JSON.parse(localStorage.getItem('loveStationSettings') || '{}');
            if (settings) {
                appSettings = { ...appSettings, ...settings };
                if (appSettings.github === undefined) {
                    appSettings.github = { token: '', repo: '', branch: 'main' };
                }
                if (appSettings.customTexts === undefined) {
                    appSettings.customTexts = {};
                }
            }
        }

        // 初始化示例数据
        function initSampleData() {
            if (photos.length === 0) {
                const samplePhoto = {
                    id: 1,
                    url: 'https://doc.doubao.com/s/HLfGw4b69Q4/',
                    name: '第一次约会',
                    size: 204800,
                    date: new Date('2024-01-15'),
                    description: '这是我们第一次约会的甜蜜回忆'
                };
                photos.push(samplePhoto);
                addPhoto(samplePhoto);
                stats.photos = 1;
            }
            
            if (diaries.length === 0) {
                const sampleDiary = {
                    id: 1,
                    title: '第一次约会',
                    content: '今天和心爱的人第一次正式约会，我们去了那家一直想去的咖啡馆。阳光透过窗户洒在她的脸上，那一刻我觉得整个世界都变得温柔了。她的笑容那么甜美，让我心动不已。这是我们爱情故事的开始，我会永远珍藏这美好的一天。',
                    date: new Date('2024-01-15'),
                    comments: []
                };
                diaries.push(sampleDiary);
                addDiary(sampleDiary);
                stats.diaries = 1;
            }
            
            updateStats();
            updateRecentMessages();
        }

        // 工具函数
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }

        function formatRelativeTime(date) {
            const now = new Date();
            const diff = now - date;
            const seconds = Math.floor(diff / 1000);
            const minutes = Math.floor(seconds / 60);
            const hours = Math.floor(minutes / 60);
            const days = Math.floor(hours / 24);
            
            if (seconds < 60) return '刚刚';
            if (minutes < 60) return minutes + '分钟前';
            if (hours < 24) return hours + '小时前';
            if (days < 30) return days + '天前';
            return date.toLocaleDateString('zh-CN');
        }

        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.className = `fixed top-20 right-4 z-50 px-6 py-3 rounded-lg shadow-lg transform translate-x-full transition-transform duration-300 ${
                type === 'success' ? 'bg-love text-white' :
                type === 'error' ? 'bg-red-500 text-white' :
                type === 'warning' ? 'bg-yellow-500 text-white' :
                'bg-blue-500 text-white'
            } font-love`;
            notification.innerHTML = `<i class="fa fa-heart mr-2"></i>${message}`;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(0)';
            }, 100);
            
            setTimeout(() => {
                notification.style.transform = 'translateX(full)';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
