<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>è‡´æˆ‘çš„ä¹–ä¹– - ä¸“å±çˆ±æƒ…çºªå¿µå†Œ</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#FF6B9D',
                        secondary: '#C44569',
                        accent: '#F8B500',
                        love: {
                            50: '#FFF0F5',
                            100: '#FFE4E6',
                            200: '#FFB6C1',
                            300: '#FF69B4',
                            400: '#FF1493',
                            500: '#DA70D6',
                            600: '#DDA0DD',
                            700: '#9370DB',
                            800: '#8A2BE2',
                            900: '#9932CC'
                        }
                    },
                    fontFamily: {
                        romantic: ['Georgia', 'serif'],
                        elegant: ['Inter', 'sans-serif']
                    },
                    animation: {
                        'float': 'float 6s ease-in-out infinite',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                        'bounce-slow': 'bounce 2s infinite',
                        'glow': 'glow 2s ease-in-out infinite alternate',
                        'celebrate': 'celebrate 0.6s ease-out',
                        'sparkle': 'sparkle 1.5s ease-in-out infinite',
                        'fadeInUp': 'fadeInUp 0.8s ease-out',
                        'scaleIn': 'scaleIn 0.5s ease-out',
                        'heartExplosion': 'heartExplosion 1s ease-out',
                        'floatHeart': 'floatHeart 3s ease-in-out infinite',
                        'rotate3d': 'rotate3d 20s linear infinite',
                        'pulseGlow': 'pulseGlow 2s ease-in-out infinite',
                        'wave': 'wave 2s ease-in-out infinite'
                    },
                    keyframes: {
                        float: {
                            '0%, 100%': { transform: 'translateY(0px)' },
                            '50%': { transform: 'translateY(-20px)' }
                        },
                        glow: {
                            '0%': { boxShadow: '0 0 20px rgba(255, 107, 157, 0.5)' },
                            '100%': { boxShadow: '0 0 30px rgba(255, 107, 157, 0.8), 0 0 40px rgba(255, 107, 157, 0.3)' }
                        },
                        celebrate: {
                            '0%': { transform: 'scale(0.5)', opacity: '0' },
                            '50%': { transform: 'scale(1.1)' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        sparkle: {
                            '0%, 100%': { transform: 'scale(1) rotate(0deg)' },
                            '50%': { transform: 'scale(1.2) rotate(180deg)' }
                        },
                        fadeInUp: {
                            '0%': { transform: 'translateY(30px)', opacity: '0' },
                            '100%': { transform: 'translateY(0)', opacity: '1' }
                        },
                        scaleIn: {
                            '0%': { transform: 'scale(0)', opacity: '0' },
                            '100%': { transform: 'scale(1)', opacity: '1' }
                        },
                        heartExplosion: {
                            '0%': { transform: 'scale(1)', opacity: '1' },
                            '50%': { transform: 'scale(1.5)', opacity: '0.8' },
                            '100%': { transform: 'scale(2)', opacity: '0' }
                        },
                        floatHeart: {
                            '0%, 100%': { transform: 'translateY(0px) rotate(0deg)' },
                            '50%': { transform: 'translateY(-15px) rotate(5deg)' }
                        },
                        rotate3d: {
                            '0%': { transform: 'rotateX(0deg) rotateY(0deg)' },
                            '100%': { transform: 'rotateX(360deg) rotateY(360deg)' }
                        },
                        pulseGlow: {
                            '0%, 100%': { boxShadow: '0 0 5px rgba(255, 107, 157, 0.5)' },
                            '50%': { boxShadow: '0 0 20px rgba(255, 107, 157, 0.8)' }
                        },
                        wave: {
                            '0%, 100%': { transform: 'scaleX(1)' },
                            '50%': { transform: 'scaleX(1.1)' }
                        }
                    }
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .gradient-love {
                background: linear-gradient(135deg, #FF6B9D 0%, #C44569 50%, #9B59B6 100%);
            }
            .gradient-text {
                background: linear-gradient(135deg, #FF6B9D, #9B59B6);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }
            .glass-effect {
                background: rgba(255, 255, 255, 0.25);
                backdrop-filter: blur(10px);
                border: 1px solid rgba(255, 255, 255, 0.18);
            }
            .heart-beat {
                animation: heartbeat 1.5s ease-in-out infinite;
            }
            .floating-hearts::before {
                content: 'ğŸ’•';
                position: absolute;
                animation: floatHeart 3s ease-in-out infinite;
            }
            .parallax-bg {
                background-attachment: fixed;
                background-position: center;
                background-repeat: no-repeat;
                background-size: cover;
            }
            .text-shadow {
                text-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);
            }
            .hover-lift {
                transition: transform 0.3s ease, box-shadow 0.3s ease;
            }
            .hover-lift:hover {
                transform: translateY(-8px);
                box-shadow: 0 20px 40px rgba(255, 107, 157, 0.3);
            }
            @keyframes heartbeat {
                0% { transform: scale(1); }
                14% { transform: scale(1.1); }
                28% { transform: scale(1); }
                42% { transform: scale(1.1); }
                70% { transform: scale(1); }
            }
            .delete-btn {
                opacity: 1 !important;
                transition: all 0.3s ease;
                animation: pulseGlow 2s ease-in-out infinite;
            }
            .delete-btn:hover {
                transform: scale(1.2);
                background-color: #ef4444 !important;
                animation: none;
                box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
            }
            .love-particles {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 1000;
            }
        }
    </style>
</head>
<body class="min-h-screen overflow-x-hidden" style="background-image: url('https://aka.doubaocdn.com/s/ngDd1vPAgQ'); background-size: cover; background-position: center; background-attachment: fixed;">
    
    <!-- çˆ±æƒ…ç²’å­èƒŒæ™¯ -->
    <div class="love-particles" id="loveParticles"></div>
    
    <!-- æµ®åŠ¨çˆ±å¿ƒè£…é¥° -->
    <div class="fixed inset-0 pointer-events-none overflow-hidden">
        <div class="absolute top-20 left-10 text-4xl text-love-300 opacity-60 animate-float" style="animation-delay: 0s;">ğŸ’•</div>
        <div class="absolute top-40 right-20 text-3xl text-love-400 opacity-50 animate-float" style="animation-delay: 1s;">ğŸ’–</div>
        <div class="absolute bottom-32 left-1/4 text-5xl text-love-200 opacity-40 animate-float" style="animation-delay: 2s;">ğŸ’˜</div>
        <div class="absolute bottom-20 right-1/3 text-4xl text-love-500 opacity-50 animate-float" style="animation-delay: 3s;">ğŸ’</div>
        <div class="absolute top-1/2 left-1/3 text-3xl text-love-300 opacity-60 animate-float" style="animation-delay: 4s;">ğŸ’“</div>
        <div class="absolute top-1/3 right-1/4 text-4xl text-love-400 opacity-50 animate-floatHeart" style="animation-delay: 0.5s;">ğŸ’</div>
        <div class="absolute bottom-1/3 left-1/2 text-3xl text-love-300 opacity-60 animate-floatHeart" style="animation-delay: 1.5s;">ğŸ’—</div>
    </div>

    <!-- å¯¼èˆªæ  -->
    <nav class="relative z-50 glass-effect border-b border-white/20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 gradient-love rounded-full flex items-center justify-center heart-beat animate-glow">
                        <i class="fa fa-heart text-white text-lg"></i>
                    </div>
                    <h1 class="text-xl font-elegant font-bold gradient-text">è‡´æˆ‘çš„ä¹–ä¹–</h1>
                </div>
                <div class="hidden md:flex items-center space-x-8">
                    <a href="#home" class="text-white hover:text-love-200 transition-colors duration-300">é¦–é¡µ</a>
                    <a href="#timer" class="text-white hover:text-love-200 transition-colors duration-300">çˆ±æƒ…è®¡æ—¶å™¨</a>
                    <a href="#album" class="text-white hover:text-love-200 transition-colors duration-300">ç”œèœœç›¸å†Œ</a>
                    <a href="#diary" class="text-white hover:text-love-200 transition-colors duration-300">çˆ±æƒ…æ—¥è®°</a>
                    <a href="#messages" class="text-white hover:text-love-200 transition-colors duration-300">ç”œèœœç•™è¨€</a>
                    <a href="#anniversary" class="text-white hover:text-love-200 transition-colors duration-300">çºªå¿µæ—¥</a>
                    <button onclick="syncAllData()" class="text-white hover:text-love-200 transition-colors duration-300 hover:scale-110 transition-transform relative">
                        <i class="fa fa-refresh text-lg"></i>
                        <span id="syncBadge" class="absolute -top-2 -right-2 w-4 h-4 bg-green-500 rounded-full text-xs text-white flex items-center justify-center hidden">âœ“</span>
                    </button>
                </div>
                <button class="md:hidden text-white hover:scale-110 transition-transform">
                    <i class="fa fa-bars text-xl"></i>
                </button>
            </div>
        </div>
    </nav>

    <!-- ä¸»é¡µè‹±é›„åŒºåŸŸ -->
    <section id="home" class="relative z-10 min-h-screen flex items-center justify-center">
        <div class="text-center text-white px-4 max-w-4xl mx-auto animate-fadeInUp">
            <div class="mb-8 animate-bounce-slow">
                <div class="w-32 h-32 gradient-love rounded-full flex items-center justify-center mx-auto heart-beat animate-glow relative">
                    <i class="fa fa-heart text-white text-6xl"></i>
                    <!-- æ—‹è½¬çš„çˆ±å¿ƒè£…é¥° -->
                    <div class="absolute -top-4 -right-4 text-2xl animate-rotate3d">ğŸ’«</div>
                    <div class="absolute -bottom-4 -left-4 text-2xl animate-rotate3d" style="animation-direction: reverse;">âœ¨</div>
                </div>
            </div>
            <h1 class="text-5xl md:text-7xl font-romantic font-bold mb-6 gradient-text text-shadow animate-scaleIn">
                è‡´æˆ‘çš„ä¹–ä¹–
            </h1>
            <p class="text-xl md:text-2xl mb-8 font-elegant opacity-90 leading-relaxed animate-fadeInUp" style="animation-delay: 0.3s;">
                æ¯ä¸€å¤©éƒ½æƒ³å‘Šè¯‰ä½ ï¼Œä½ æ˜¯æˆ‘ç”Ÿå‘½ä¸­æœ€ç¾çš„ç¤¼ç‰©<br>
                è¿™æ˜¯åªå±äºæˆ‘ä»¬ä¸¤ä¸ªäººçš„çˆ±æƒ…å°ç«™
            </p>
            <div class="flex flex-col sm:flex-row gap-4 justify-center items-center animate-fadeInUp" style="animation-delay: 0.6s;">
                <button onclick="scrollToSection('timer')" class="px-8 py-4 gradient-love rounded-full text-white font-semibold hover:scale-105 transition-transform duration-300 animate-glow hover-lift">
                    <i class="fa fa-clock-o mr-2"></i>æŸ¥çœ‹æˆ‘ä»¬çš„çˆ±æƒ…æ—¶å…‰
                </button>
                <button onclick="scrollToSection('messages')" class="px-8 py-4 glass-effect rounded-full text-white font-semibold hover:scale-105 transition-transform duration-300 hover-lift">
                    <i class="fa fa-heart mr-2"></i>ç»™ä¹–ä¹–å†™ç•™è¨€
                </button>
                <button onclick="syncAllData()" class="px-6 py-4 bg-green-500 hover:bg-green-600 rounded-full text-white font-semibold hover:scale-105 transition-transform duration-300 hover-lift">
                    <i class="fa fa-refresh mr-2"></i>åŒæ­¥æ•°æ®
                </button>
            </div>
        </div>
    </section>

    <!-- çˆ±æƒ…è®¡æ—¶å™¨ -->
    <section id="timer" class="relative z-10 py-20">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-romantic font-bold gradient-text mb-4 animate-fadeInUp">çˆ±æƒ…è®¡æ—¶å™¨</h2>
                <p class="text-xl text-white/80 font-elegant animate-fadeInUp" style="animation-delay: 0.2s;">è®°å½•æˆ‘ä»¬ç›¸çˆ±çš„æ¯ä¸€åˆ†æ¯ä¸€ç§’</p>
            </div>
            
            <div class="glass-effect rounded-3xl p-8 md:p-12 max-w-4xl mx-auto hover-lift">
                <!-- è¡¨ç™½å¼€å§‹æŒ‰é’® -->
                <div id="proposalSection" class="text-center mb-12 animate-fadeInUp">
                    <div class="w-24 h-24 gradient-love rounded-full flex items-center justify-center mx-auto mb-6 animate-pulse-slow animate-glow">
                        <i class="fa fa-heart text-white text-4xl"></i>
                    </div>
                    <h3 class="text-2xl font-elegant font-semibold text-white mb-4">äº²çˆ±çš„ä¹–ä¹–</h3>
                    <p class="text-lg text-white/80 font-elegant mb-8 max-w-2xl mx-auto leading-relaxed">
                        é‡è§ä½ æ˜¯æˆ‘ç”Ÿå‘½ä¸­æœ€ç¾å¥½çš„äº‹æƒ…ã€‚ä»ç¬¬ä¸€æ¬¡è§åˆ°ä½ çš„é‚£ä¸€åˆ»èµ·ï¼Œæˆ‘å°±çŸ¥é“ä½ æ˜¯æˆ‘è¦æ‰¾çš„é‚£ä¸ªäººã€‚
                        æ„¿æ„è®©æˆ‘ä»¬çš„çˆ±æƒ…ä»è¿™ä¸€åˆ»å¼€å§‹è®¡æ—¶å—ï¼Ÿ
                    </p>
                    <button id="startLoveTimer" onclick="startLoveTimer()" class="px-12 py-4 gradient-love rounded-full text-white font-semibold text-lg hover:scale-110 transition-transform duration-300 animate-glow hover-lift">
                        <i class="fa fa-heart mr-2"></i>æˆ‘æ„¿æ„ï¼Œè®©æˆ‘ä»¬å¼€å§‹å§ï¼
                    </button>
                </div>
                
                <!-- è®¡æ—¶å™¨æ˜¾ç¤ºåŒºåŸŸ -->
                <div id="timerSection" class="hidden">
                    <div class="text-center mb-8">
                        <h3 class="text-2xl font-elegant font-semibold text-white mb-2 animate-fadeInUp">æˆ‘ä»¬åœ¨ä¸€èµ·å·²ç»</h3>
                        <div class="flex justify-center items-center space-x-6 md:space-x-12" id="loveTimer">
                            <div class="text-center animate-scaleIn" style="animation-delay: 0.1s;">
                                <div class="text-4xl md:text-6xl font-bold gradient-text mb-2" id="days">0</div>
                                <div class="text-white/70 font-elegant">å¤©</div>
                            </div>
                            <div class="text-center animate-scaleIn" style="animation-delay: 0.2s;">
                                <div class="text-4xl md:text-6xl font-bold gradient-text mb-2" id="hours">0</div>
                                <div class="text-white/70 font-elegant">æ—¶</div>
                            </div>
                            <div class="text-center animate-scaleIn" style="animation-delay: 0.3s;">
                                <div class="text-4xl md:text-6xl font-bold gradient-text mb-2" id="minutes">0</div>
                                <div class="text-white/70 font-elegant">åˆ†</div>
                            </div>
                            <div class="text-center animate-scaleIn" style="animation-delay: 0.4s;">
                                <div class="text-4xl md:text-6xl font-bold gradient-text mb-2" id="seconds">0</div>
                                <div class="text-white/70 font-elegant">ç§’</div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- æ§åˆ¶æŒ‰é’® -->
                    <div class="text-center mb-8">
                        <button onclick="pauseTimer()" id="pauseBtn" class="px-6 py-2 mx-2 bg-yellow-500 hover:bg-yellow-600 rounded-full text-white font-semibold transition-colors duration-300 hover:scale-105">
                            <i class="fa fa-pause mr-1"></i>æš‚åœ
                        </button>
                        <button onclick="resumeTimer()" id="resumeBtn" class="px-6 py-2 mx-2 bg-green-500 hover:bg-green-600 rounded-full text-white font-semibold transition-colors duration-300 hover:scale-105 hidden">
                            <i class="fa fa-play mr-1"></i>ç»§ç»­
                        </button>
                        <button onclick="resetTimer()" class="px-6 py-2 mx-2 bg-red-500 hover:bg-red-600 rounded-full text-white font-semibold transition-colors duration-300 hover:scale-105">
                            <i class="fa fa-bullseye mr-1"></i>é‡ç½®
                        </button>
                    </div>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-12">
                        <div class="text-center p-6 glass-effect rounded-2xl hover-lift animate-fadeInUp" style="animation-delay: 0.1s;">
                            <div class="w-16 h-16 gradient-love rounded-full flex items-center justify-center mx-auto mb-4 animate-pulseGlow">
                                <i class="fa fa-sun-o text-white text-2xl"></i>
                            </div>
                            <div class="text-2xl font-bold text-white mb-2" id="sunriseCount">0</div>
                            <div class="text-white/70 font-elegant">ä¸ªæ—¥å‡º</div>
                        </div>
                        <div class="text-center p-6 glass-effect rounded-2xl hover-lift animate-fadeInUp" style="animation-delay: 0.2s;">
                            <div class="w-16 h-16 gradient-love rounded-full flex items-center justify-center mx-auto mb-4 animate-pulseGlow">
                                <i class="fa fa-moon-o text-white text-2xl"></i>
                            </div>
                            <div class="text-2xl font-bold text-white mb-2" id="sunsetCount">0</div>
                            <div class="text-white/70 font-elegant">ä¸ªæ—¥è½</div>
                        </div>
                        <div class="text-center p-6 glass-effect rounded-2xl hover-lift animate-fadeInUp" style="animation-delay: 0.3s;">
                            <div class="w-16 h-16 gradient-love rounded-full flex items-center justify-center mx-auto mb-4 animate-pulseGlow">
                                <i class="fa fa-heart text-white text-2xl"></i>
                            </div>
                            <div class="text-2xl font-bold text-white mb-2">âˆ</div>
                            <div class="text-white/70 font-elegant">ä»½çˆ±æ„</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- ç”œèœœç›¸å†Œ -->
    <section id="album" class="relative z-10 py-20">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-romantic font-bold gradient-text mb-4 animate-fadeInUp">ç”œèœœç›¸å†Œ</h2>
                <p class="text-xl text-white/80 font-elegant animate-fadeInUp" style="animation-delay: 0.2s;">è®°å½•æˆ‘ä»¬çš„æ¯ä¸€ä¸ªç¾å¥½ç¬é—´</p>
            </div>
            
            <!-- ä¸Šä¼ ç…§ç‰‡åŒºåŸŸ -->
            <div class="text-center mb-12 animate-fadeInUp" style="animation-delay: 0.3s;">
                <label class="px-8 py-4 gradient-love rounded-full text-white font-semibold hover:scale-105 transition-transform duration-300 cursor-pointer animate-glow hover-lift">
                    <i class="fa fa-plus mr-2"></i>ä¸Šä¼ æ–°ç…§ç‰‡
                    <input type="file" id="photoUpload" accept="image/*" multiple class="hidden" onchange="uploadPhotos(event)">
                </label>
            </div>
            
            <div id="photoGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- ç…§ç‰‡å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </section>

    <!-- çˆ±æƒ…æ—¥è®° -->
    <section id="diary" class="relative z-10 py-20">
        <div class="max-w-4xl mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-romantic font-bold gradient-text mb-4 animate-fadeInUp">çˆ±æƒ…æ—¥è®°</h2>
                <p class="text-xl text-white/80 font-elegant animate-fadeInUp" style="animation-delay: 0.2s;">å†™ä¸‹æˆ‘ä»¬çš„çˆ±æƒ…æ•…äº‹</p>
            </div>
            
            <!-- æ·»åŠ æ—¥è®°æŒ‰é’® -->
            <div class="text-center mb-12 animate-fadeInUp" style="animation-delay: 0.3s;">
                <button onclick="showAddDiaryModal()" class="px-8 py-4 gradient-love rounded-full text-white font-semibold hover:scale-105 transition-transform duration-300 animate-glow hover-lift">
                    <i class="fa fa-pencil mr-2"></i>å†™æ–°æ—¥è®°
                </button>
            </div>
            
            <div id="diaryList" class="space-y-6">
                <!-- æ—¥è®°å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </section>

    <!-- æ·»åŠ æ—¥è®°æ¨¡æ€æ¡† -->
    <div id="addDiaryModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass-effect rounded-3xl p-8 max-w-2xl w-full hover-lift animate-scaleIn">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-semibold text-white">å†™æ–°æ—¥è®°</h3>
                    <button onclick="hideAddDiaryModal()" class="text-white/60 hover:text-white hover:scale-110 transition-transform">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <input type="text" id="diaryTitle" placeholder="æ—¥è®°æ ‡é¢˜" class="w-full p-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-love-300 focus:ring-2 focus:ring-love-300">
                    <input type="date" id="diaryDate" class="w-full p-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-love-300 focus:ring-2 focus:ring-love-300">
                    <textarea id="diaryContent" placeholder="å†™ä¸‹ä½ ä»¬çš„æ•…äº‹..." class="w-full h-32 p-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-love-300 focus:ring-2 focus:ring-love-300 resize-none font-elegant"></textarea>
                    <div class="flex space-x-4">
                        <button onclick="hideAddDiaryModal()" class="flex-1 py-3 border border-white/30 text-white rounded-xl hover:bg-white/10 transition-colors duration-300 hover:scale-105">
                            å–æ¶ˆ
                        </button>
                        <button onclick="addDiary()" class="flex-1 py-3 gradient-love rounded-xl text-white font-semibold hover:scale-105 transition-transform duration-300 animate-glow">
                            ä¿å­˜æ—¥è®°
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ç”œèœœç•™è¨€ -->
    <section id="messages" class="relative z-10 py-20">
        <div class="max-w-4xl mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-romantic font-bold gradient-text mb-4 animate-fadeInUp">ç”œèœœç•™è¨€</h2>
                <p class="text-xl text-white/80 font-elegant animate-fadeInUp" style="animation-delay: 0.2s;">æƒ³å¯¹ä¹–ä¹–è¯´çš„æ‚„æ‚„è¯</p>
            </div>
            
            <!-- ç•™è¨€è¾“å…¥æ¡† -->
            <div class="glass-effect rounded-3xl p-8 mb-12 hover-lift animate-fadeInUp" style="animation-delay: 0.3s;">
                <h3 class="text-2xl font-semibold text-white mb-6 text-center">ç»™ä¹–ä¹–å†™å¿ƒé‡Œè¯</h3>
                <textarea id="messageInput" placeholder="äº²çˆ±çš„ä¹–ä¹–ï¼Œæˆ‘æƒ³å¯¹ä½ è¯´..." class="w-full h-32 p-4 rounded-2xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-love-300 focus:ring-2 focus:ring-love-300 resize-none font-elegant transition-all duration-300 hover:border-love-200"></textarea>
                <div class="flex justify-between items-center mt-4">
                    <div class="text-white/60 text-sm font-elegant">
                        <i class="fa fa-heart text-love-300 mr-1"></i>
                        è®©çˆ±è¯­ä¼ é€’ä¸‹å»
                    </div>
                    <button onclick="addMessage()" class="px-8 py-3 gradient-love rounded-full text-white font-semibold hover:scale-105 transition-transform duration-300 animate-glow hover-lift">
                        <i class="fa fa-send mr-2"></i>å‘é€ç»™ä¹–ä¹–
                    </button>
                </div>
            </div>
            
            <!-- ç•™è¨€åˆ—è¡¨ -->
            <div id="messageList" class="space-y-6">
                <!-- ç•™è¨€å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </section>

    <!-- é‡è¦çºªå¿µæ—¥ -->
    <section id="anniversary" class="relative z-10 py-20">
        <div class="max-w-6xl mx-auto px-4">
            <div class="text-center mb-16">
                <h2 class="text-4xl md:text-5xl font-romantic font-bold gradient-text mb-4 animate-fadeInUp">é‡è¦çºªå¿µæ—¥</h2>
                <p class="text-xl text-white/80 font-elegant animate-fadeInUp" style="animation-delay: 0.2s;">æ¯ä¸€ä¸ªå€¼å¾—åº†ç¥çš„ç‰¹æ®Šæ—¥å­</p>
            </div>
            
            <!-- æ·»åŠ çºªå¿µæ—¥æŒ‰é’® -->
            <div class="text-center mb-12 animate-fadeInUp" style="animation-delay: 0.3s;">
                <button onclick="showAddAnniversaryModal()" class="px-8 py-4 gradient-love rounded-full text-white font-semibold hover:scale-105 transition-transform duration-300 animate-glow hover-lift">
                    <i class="fa fa-plus mr-2"></i>æ·»åŠ çºªå¿µæ—¥
                </button>
            </div>
            
            <div id="anniversaryGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- çºªå¿µæ—¥å°†é€šè¿‡JavaScriptåŠ¨æ€åŠ è½½ -->
            </div>
        </div>
    </section>

    <!-- æ·»åŠ çºªå¿µæ—¥æ¨¡æ€æ¡† -->
    <div id="addAnniversaryModal" class="fixed inset-0 bg-black/50 backdrop-blur-sm z-50 hidden">
        <div class="flex items-center justify-center min-h-screen p-4">
            <div class="glass-effect rounded-3xl p-8 max-w-md w-full hover-lift animate-scaleIn">
                <div class="flex justify-between items-center mb-6">
                    <h3 class="text-2xl font-semibold text-white">æ·»åŠ çºªå¿µæ—¥</h3>
                    <button onclick="hideAddAnniversaryModal()" class="text-white/60 hover:text-white hover:scale-110 transition-transform">
                        <i class="fa fa-times text-xl"></i>
                    </button>
                </div>
                
                <div class="space-y-4">
                    <input type="text" id="anniversaryTitle" placeholder="çºªå¿µæ—¥åç§°" class="w-full p-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-love-300 focus:ring-2 focus:ring-love-300">
                    <input type="date" id="anniversaryDate" class="w-full p-3 rounded-xl bg-white/10 border border-white/20 text-white placeholder-white/60 focus:outline-none focus:border-love-300 focus:ring-2 focus:ring-love-300">
                    <select id="anniversaryIcon" class="w-full p-3 rounded-xl bg-white/10 border border-white/20 text-white focus:outline-none focus:border-love-300 focus:ring-2 focus:ring-love-300">
                        <option value="heart">â¤ï¸ çˆ±å¿ƒ</option>
                        <option value="gift">ğŸ ç¤¼ç‰©</option>
                        <option value="star">â­ æ˜Ÿæ˜Ÿ</option>
                        <option value="calendar">ğŸ“… æ—¥å†</option>
                        <option value="camera">ğŸ“· ç›¸æœº</option>
                        <option value="ring">ğŸ’ æˆ’æŒ‡</option>
                        <option value="music">ğŸµ éŸ³ä¹</option>
                        <option value="travel">âœˆï¸ æ—…è¡Œ</option>
                    </select>
                    <div class="flex space-x-4">
                        <button onclick="hideAddAnniversaryModal()" class="flex-1 py-3 border border-white/30 text-white rounded-xl hover:bg-white/10 transition-colors duration-300 hover:scale-105">
                            å–æ¶ˆ
                        </button>
                        <button onclick="addAnniversary()" class="flex-1 py-3 gradient-love rounded-xl text-white font-semibold hover:scale-105 transition-transform duration-300 animate-glow">
                            ä¿å­˜çºªå¿µæ—¥
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- é¡µè„š -->
    <footer class="relative z-10 py-12 border-t border-white/20">
        <div class="max-w-6xl mx-auto px-4 text-center">
            <div class="flex items-center justify-center space-x-3 mb-6 animate-fadeInUp">
                <div class="w-10 h-10 gradient-love rounded-full flex items-center justify-center heart-beat animate-glow">
                    <i class="fa fa-heart text-white"></i>
                </div>
                <h3 class="text-2xl font-elegant font-bold gradient-text">è‡´æˆ‘çš„ä¹–ä¹–</h3>
            </div>
            <p class="text-white/70 font-elegant mb-6 max-w-2xl mx-auto leading-relaxed animate-fadeInUp" style="animation-delay: 0.2s;">
                æ„¿æˆ‘ä»¬çš„çˆ±æƒ…åƒè¿™ç½‘ç«™ä¸€æ ·ï¼Œæ°¸è¿œç¾å¥½ã€æ°¸è¿œæ–°é²œã€‚æ¯ä¸€å¤©éƒ½æ˜¯æ–°çš„å¼€å§‹ï¼Œæ¯ä¸€åˆ»éƒ½å€¼å¾—çæƒœã€‚
                è¿™æ˜¯åªå±äºæˆ‘ä»¬ä¸¤ä¸ªäººçš„çˆ±æƒ…å°ç«™ï¼Œè®°å½•ç€æˆ‘ä»¬æœ€ç¾å¥½çš„å›å¿†ã€‚
            </p>
            <div class="flex justify-center space-x-6 mb-8 animate-fadeInUp" style="animation-delay: 0.3s;">
                <button onclick="scrollToSection('home')" class="w-12 h-12 gradient-love rounded-full flex items-center justify-center hover:scale-110 transition-transform duration-300 hover-lift">
                    <i class="fa fa-heart text-white"></i>
                </button>
                <button onclick="scrollToSection('album')" class="w-12 h-12 gradient-love rounded-full flex items-center justify-center hover:scale-110 transition-transform duration-300 hover-lift">
                    <i class="fa fa-camera text-white"></i>
                </button>
                <button onclick="scrollToSection('diary')" class="w-12 h-12 gradient-love rounded-full flex items-center justify-center hover:scale-110 transition-transform duration-300 hover-lift">
                    <i class="fa fa-book text-white"></i>
                </button>
                <button onclick="scrollToSection('messages')" class="w-12 h-12 gradient-love rounded-full flex items-center justify-center hover:scale-110 transition-transform duration-300 hover-lift">
                    <i class="fa fa-gift text-white"></i>
                </button>
            </div>
            <div class="text-white/50 text-sm font-elegant animate-fadeInUp" style="animation-delay: 0.4s;">
                Â© 2024 è‡´æˆ‘çš„ä¹–ä¹– - ä¸“å±çˆ±æƒ…çºªå¿µå†Œ | ç”¨å¿ƒè®°å½•æ¯ä¸€åˆ»
            </div>
        </div>
    </footer>

    <script src="leancloud-proxy.js"></script>
    <script>
        // LeanCloudé…ç½® - è¯·åœ¨è¿™é‡Œå¡«å†™æ‚¨çš„LeanCloud App IDå’ŒApp Key
        const LEANCLOUD_CONFIG = {
            appId: 'vlZDZ6PfwrEFBqML5gsoIoZR-gzGzoHsz',
            appKey: 'fBjE3MOUBxa5WW1FliybA7xx',
            serverURL: 'https://vlzdz6pf.lc-cn-n1-shared.com'
        };

        // å…¨å±€å˜é‡
        let loveStartDate = null;
        let yourName = 'æˆ‘';
        let partnerName = 'ä¹–ä¹–';
        let timerInterval = null;
        let isTimerRunning = false;
        let isTimerPaused = false;
        let timerOffset = 0;
        let dataSync = null;

        // åˆå§‹åŒ–åº”ç”¨
        document.addEventListener('DOMContentLoaded', function() {
            initializeLoveParticles();
            initializeDataSync();
            loadSettings();
            checkTimerStatus();
            loadAllData();
            showNotification('æ¬¢è¿æ¥åˆ°æˆ‘ä»¬çš„çˆ±æƒ…å°ç«™ï¼', 'success');
            
            // åˆå§‹åŒ–æ—¥æœŸé€‰æ‹©å™¨ä¸ºä»Šå¤©
            if (document.getElementById('diaryDate')) {
                document.getElementById('diaryDate').value = new Date().toISOString().split('T')[0];
            }
            if (document.getElementById('anniversaryDate')) {
                document.getElementById('anniversaryDate').value = new Date().toISOString().split('T')[0];
            }
        });

        // åˆå§‹åŒ–æ•°æ®åŒæ­¥
        function initializeDataSync() {
            try {
                // æ£€æŸ¥æ˜¯å¦é…ç½®äº†LeanCloud
                if (!LEANCLOUD_CONFIG.appId || !LEANCLOUD_CONFIG.appKey) {
                    showNotification('è¯·å…ˆé…ç½®LeanCloud App IDå’ŒApp Keyï¼', 'error');
                    return;
                }

                dataSync = new LoveSiteDataSync(LEANCLOUD_CONFIG);
                dataSync.init();

                // è®¾ç½®æ•°æ®æ›´æ–°ç›‘å¬å™¨
                dataSync.onDataUpdated((type, data) => {
                    console.log(`Data updated: ${type}`, data);
                    updateUIForDataType(type, data);
                });

            } catch (error) {
                console.error('Failed to initialize data sync:', error);
                showNotification('æ•°æ®åŒæ­¥åˆå§‹åŒ–å¤±è´¥', 'error');
            }
        }

        // åŒæ­¥æ‰€æœ‰æ•°æ®
        function syncAllData() {
            if (!dataSync) {
                showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                return;
            }

            // æ˜¾ç¤ºåŒæ­¥ä¸­çŠ¶æ€
            const syncBadge = document.getElementById('syncBadge');
            if (syncBadge) {
                syncBadge.classList.remove('hidden', 'bg-green-500');
                syncBadge.classList.add('bg-yellow-500');
                syncBadge.textContent = '...';
            }

            dataSync.syncAllData().then(success => {
                // æ›´æ–°åŒæ­¥çŠ¶æ€
                if (syncBadge) {
                    if (success) {
                        syncBadge.classList.remove('bg-yellow-500');
                        syncBadge.classList.add('bg-green-500');
                        syncBadge.textContent = 'âœ“';
                        
                        // 3ç§’åéšè—æˆåŠŸæ ‡å¿—
                        setTimeout(() => {
                            syncBadge.classList.add('hidden');
                        }, 3000);
                    } else {
                        syncBadge.classList.remove('bg-yellow-500');
                        syncBadge.classList.add('bg-red-500');
                        syncBadge.textContent = 'âœ—';
                    }
                }
            });
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        function loadAllData() {
            loadPhotos();
            loadDiary();
            loadMessages();
            loadAnniversaries();
        }

        // æ ¹æ®æ•°æ®ç±»å‹æ›´æ–°UI
        function updateUIForDataType(type, data) {
            switch (type) {
                case 'Photo':
                    renderPhotos(data);
                    break;
                case 'Diary':
                    renderDiary(data);
                    break;
                case 'Message':
                    renderMessages(data);
                    break;
                case 'Anniversary':
                    renderAnniversaries(data);
                    break;
                case 'Setting':
                    loadSettings();
                    break;
            }
        }

        // åˆå§‹åŒ–çˆ±æƒ…ç²’å­æ•ˆæœ
        function initializeLoveParticles() {
            const particles = document.getElementById('loveParticles');
            if (!particles) return;

            // åˆ›å»ºéšæœºæµ®åŠ¨çš„çˆ±å¿ƒç²’å­
            for (let i = 0; i < 15; i++) {
                setTimeout(() => {
                    createFloatingParticle();
                }, i * 1000);
            }

            // å®šæœŸåˆ›å»ºæ–°ç²’å­
            setInterval(createFloatingParticle, 3000);
        }

        // åˆ›å»ºæµ®åŠ¨ç²’å­
        function createFloatingParticle() {
            const particles = document.getElementById('loveParticles');
            if (!particles) return;

            const particle = document.createElement('div');
            const hearts = ['ğŸ’•', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’', 'ğŸ’Œ', 'ğŸ’Ÿ'];
            particle.textContent = hearts[Math.floor(Math.random() * hearts.length)];
            
            const size = Math.random() * 20 + 10;
            const left = Math.random() * 100;
            const top = Math.random() * 100;
            const duration = Math.random() * 10 + 10;
            const delay = Math.random() * 5;
            const opacity = Math.random() * 0.6 + 0.2;

            particle.style.cssText = `
                position: absolute;
                left: ${left}%;
                top: ${top}%;
                font-size: ${size}px;
                opacity: ${opacity};
                pointer-events: none;
                animation: float ${duration}s ease-in-out infinite;
                animation-delay: ${delay}s;
                z-index: 1000;
            `;

            particles.appendChild(particle);

            // è‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.style.opacity = '0';
                    particle.style.transition = 'opacity 2s ease-out';
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 2000);
                }
            }, duration * 1000);
        }

        // æ£€æŸ¥è®¡æ—¶å™¨çŠ¶æ€
        function checkTimerStatus() {
            const savedSettings = localStorage.getItem('loveSiteSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    if (settings.loveStartDate) {
                        const savedDate = new Date(settings.loveStartDate);
                        const now = new Date();
                        
                        // æ£€æŸ¥æ—¥æœŸæ˜¯å¦æœ‰æ•ˆä¸”ä¸æ˜¯æœªæ¥æ—¥æœŸ
                        if (!isNaN(savedDate.getTime()) && savedDate <= now) {
                            loveStartDate = savedDate;
                            isTimerRunning = true;
                            showTimerSection();
                            startTimer();
                        } else {
                            // æ—¥æœŸæ— æ•ˆæˆ–ä¸ºæœªæ¥æ—¥æœŸï¼Œæ˜¾ç¤ºè¡¨ç™½ç•Œé¢
                            showProposalSection();
                        }
                    } else {
                        showProposalSection();
                    }
                } catch (error) {
                    console.error('Failed to parse settings:', error);
                    showProposalSection();
                }
            } else {
                showProposalSection();
            }
        }

        // æ˜¾ç¤ºè¡¨ç™½åŒºåŸŸ
        function showProposalSection() {
            const proposalSection = document.getElementById('proposalSection');
            const timerSection = document.getElementById('timerSection');
            
            if (proposalSection) proposalSection.classList.remove('hidden');
            if (timerSection) timerSection.classList.add('hidden');
        }

        // æ˜¾ç¤ºè®¡æ—¶å™¨åŒºåŸŸ
        function showTimerSection() {
            const proposalSection = document.getElementById('proposalSection');
            const timerSection = document.getElementById('timerSection');
            
            if (proposalSection) proposalSection.classList.add('hidden');
            if (timerSection) timerSection.classList.remove('hidden');
        }

        // å¼€å§‹çˆ±æƒ…è®¡æ—¶å™¨ï¼ˆè¡¨ç™½åŠŸèƒ½ï¼‰
        function startLoveTimer() {
            // è®¾ç½®å½“å‰æ—¶é—´ä¸ºæ‹çˆ±å¼€å§‹æ—¶é—´
            loveStartDate = new Date();
            timerOffset = 0;
            
            // ä¿å­˜è®¾ç½®
            const settings = {
                loveStartDate: loveStartDate.toISOString(),
                yourName: yourName,
                partnerName: partnerName
            };
            localStorage.setItem('loveSiteSettings', JSON.stringify(settings));
            
            // åŒæ—¶ä¿å­˜åˆ°äº‘ç«¯
            if (dataSync) {
                dataSync.addItem('Setting', settings);
            }
            
            // æ›´æ–°çŠ¶æ€
            isTimerRunning = true;
            isTimerPaused = false;
            
            // æ˜¾ç¤ºæµªæ¼«åŠ¨ç”»
            showRomanticAnimation();
            
            // åˆ‡æ¢åˆ°è®¡æ—¶å™¨æ˜¾ç¤º
            setTimeout(() => {
                showTimerSection();
                startTimer();
                showNotification('æ­å–œï¼ä½ ä»¬çš„çˆ±æƒ…è®¡æ—¶å™¨å·²å¼€å§‹ï¼', 'success');
            }, 2000);
        }

        // æ˜¾ç¤ºæµªæ¼«åŠ¨ç”»
        function showRomanticAnimation() {
            // åˆ›å»ºåº†ç¥æ•ˆæœ
            for (let i = 0; i < 30; i++) {
                setTimeout(() => {
                    createHeartParticle();
                }, i * 80);
            }
            
            // åˆ›å»ºçˆ†ç‚¸çˆ±å¿ƒæ•ˆæœ
            const heart = document.createElement('div');
            heart.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-8xl animate-heartExplosion z-50';
            heart.textContent = 'ğŸ’•';
            document.body.appendChild(heart);
            
            setTimeout(() => {
                if (heart.parentNode) {
                    heart.parentNode.removeChild(heart);
                }
            }, 1000);
            
            // æ·»åŠ æ–‡å­—åŠ¨ç”»
            const text = document.createElement('div');
            text.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-4xl md:text-6xl font-bold text-white animate-fadeInUp z-50 text-center';
            text.textContent = 'â¤ï¸ æˆ‘çˆ±ä½ ï¼Œä¹–ä¹–ï¼â¤ï¸';
            text.style.textShadow = '0 0 30px rgba(255, 107, 157, 0.9)';
            text.style.animationDuration = '1s';
            document.body.appendChild(text);
            
            setTimeout(() => {
                text.style.opacity = '0';
                text.style.transition = 'opacity 1s ease-out';
                setTimeout(() => {
                    if (text.parentNode) {
                        text.parentNode.removeChild(text);
                    }
                }, 1000);
            }, 2000);
            
            // åˆ›å»º3Dæ—‹è½¬æ•ˆæœ
            const rotateHeart = document.createElement('div');
            rotateHeart.className = 'fixed top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 text-6xl animate-rotate3d z-40 opacity-70';
            rotateHeart.textContent = 'ğŸ’';
            document.body.appendChild(rotateHeart);
            
            setTimeout(() => {
                if (rotateHeart.parentNode) {
                    rotateHeart.parentNode.removeChild(rotateHeart);
                }
            }, 3000);
        }

        // åˆ›å»ºçˆ±å¿ƒç²’å­
        function createHeartParticle() {
            const particle = document.createElement('div');
            particle.className = 'fixed text-2xl animate-float z-50';
            particle.textContent = ['ğŸ’•', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’“', 'ğŸ’—', 'ğŸ’', 'ğŸ’Œ'][Math.floor(Math.random() * 8)];
            
            // éšæœºä½ç½®å’ŒåŠ¨ç”»
            const size = Math.random() * 20 + 10;
            const left = Math.random() * 100;
            const top = Math.random() * 100;
            const delay = Math.random() * 3;
            const duration = Math.random() * 4 + 4;
            
            particle.style.left = left + '%';
            particle.style.top = top + '%';
            particle.style.fontSize = size + 'px';
            particle.style.animationDelay = delay + 's';
            particle.style.animationDuration = duration + 's';
            particle.style.opacity = '0.8';
            
            document.body.appendChild(particle);
            
            // è‡ªåŠ¨ç§»é™¤
            setTimeout(() => {
                if (particle.parentNode) {
                    particle.style.opacity = '0';
                    particle.style.transition = 'opacity 1s ease-out';
                    setTimeout(() => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    }, 1000);
                }
            }, duration * 1000);
        }

        // åŠ è½½è®¾ç½®
        function loadSettings() {
            const savedSettings = localStorage.getItem('loveSiteSettings');
            if (savedSettings) {
                try {
                    const settings = JSON.parse(savedSettings);
                    if (settings.loveStartDate) {
                        loveStartDate = new Date(settings.loveStartDate);
                    }
                    yourName = settings.yourName || 'æˆ‘';
                    partnerName = settings.partnerName || 'ä¹–ä¹–';
                } catch (error) {
                    console.error('Failed to load settings:', error);
                }
            }

            // ä»äº‘ç«¯åŠ è½½æœ€æ–°è®¾ç½®
            if (dataSync) {
                const settings = dataSync.getData('Setting');
                if (settings && settings.length > 0) {
                    const latestSettings = settings[0];
                    if (latestSettings.loveStartDate) {
                        loveStartDate = new Date(latestSettings.loveStartDate);
                    }
                    yourName = latestSettings.yourName || yourName;
                    partnerName = latestSettings.partnerName || partnerName;
                }
            }
        }

        // å¼€å§‹è®¡æ—¶å™¨
        function startTimer() {
            if (!isTimerRunning || !loveStartDate || isTimerPaused) return;
            
            stopTimer(); // å…ˆåœæ­¢ç°æœ‰è®¡æ—¶å™¨
            updateLoveTimer();
            timerInterval = setInterval(updateLoveTimer, 1000);
        }

        // åœæ­¢è®¡æ—¶å™¨
        function stopTimer() {
            if (timerInterval) {
                clearInterval(timerInterval);
                timerInterval = null;
            }
        }

        // æš‚åœè®¡æ—¶å™¨
        function pauseTimer() {
            if (isTimerRunning && !isTimerPaused) {
                isTimerPaused = true;
                stopTimer();
                
                // æ›´æ–°æŒ‰é’®æ˜¾ç¤º
                const pauseBtn = document.getElementById('pauseBtn');
                const resumeBtn = document.getElementById('resumeBtn');
                if (pauseBtn) pauseBtn.classList.add('hidden');
                if (resumeBtn) resumeBtn.classList.remove('hidden');
                
                showNotification('è®¡æ—¶å™¨å·²æš‚åœ', 'info');
            }
        }

        // ç»§ç»­è®¡æ—¶å™¨
        function resumeTimer() {
            if (isTimerRunning && isTimerPaused) {
                isTimerPaused = false;
                startTimer();
                
                // æ›´æ–°æŒ‰é’®æ˜¾ç¤º
                const pauseBtn = document.getElementById('pauseBtn');
                const resumeBtn = document.getElementById('resumeBtn');
                if (pauseBtn) pauseBtn.classList.remove('hidden');
                if (resumeBtn) resumeBtn.classList.add('hidden');
                
                showNotification('è®¡æ—¶å™¨å·²ç»§ç»­', 'success');
            }
        }

        // é‡ç½®è®¡æ—¶å™¨
        function resetTimer() {
            if (confirm('ç¡®å®šè¦é‡ç½®è®¡æ—¶å™¨å—ï¼Ÿè¿™å°†æ¸…é™¤å½“å‰è®¡æ—¶è®°å½•ï¼')) {
                isTimerRunning = false;
                isTimerPaused = false;
                timerOffset = 0;
                stopTimer();
                
                // æ¸…é™¤ä¿å­˜çš„æ—¥æœŸ
                const settings = {
                    loveStartDate: null,
                    yourName: yourName,
                    partnerName: partnerName
                };
                localStorage.setItem('loveSiteSettings', JSON.stringify(settings));
                
                // åŒæ—¶æ›´æ–°äº‘ç«¯
                if (dataSync) {
                    dataSync.addItem('Setting', settings);
                }
                
                showProposalSection();
                showNotification('è®¡æ—¶å™¨å·²é‡ç½®ï¼Œè¯·é‡æ–°å¼€å§‹ï¼', 'info');
            }
        }

        // æ›´æ–°çˆ±æƒ…è®¡æ—¶å™¨
        function updateLoveTimer() {
            if (!loveStartDate || isTimerPaused) return;
            
            const now = new Date();
            const diff = now - loveStartDate + timerOffset;
            
            if (diff < 0) {
                // å¦‚æœæ—¥æœŸæ— æ•ˆï¼Œæ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
                if (document.getElementById('days')) {
                    document.getElementById('days').textContent = 'âŒ';
                    document.getElementById('hours').textContent = 'âŒ';
                    document.getElementById('minutes').textContent = 'âŒ';
                    document.getElementById('seconds').textContent = 'âŒ';
                    document.getElementById('sunriseCount').textContent = 'âŒ';
                    document.getElementById('sunsetCount').textContent = 'âŒ';
                }
                return;
            }
            
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            const minutes = Math.floor((diff % (1000 * 60 * 60)) / (1000 * 60));
            const seconds = Math.floor((diff % (1000 * 60)) / 1000);
            
            if (document.getElementById('days')) {
                document.getElementById('days').textContent = days.toLocaleString();
                document.getElementById('hours').textContent = hours.toString().padStart(2, '0');
                document.getElementById('minutes').textContent = minutes.toString().padStart(2, '0');
                document.getElementById('seconds').textContent = seconds.toString().padStart(2, '0');
                
                // æ›´æ–°æ—¥å‡ºæ—¥è½è®¡æ•°
                document.getElementById('sunriseCount').textContent = days.toLocaleString();
                document.getElementById('sunsetCount').textContent = days.toLocaleString();
            }
        }

        // ç…§ç‰‡ç›¸å…³åŠŸèƒ½
        function loadPhotos() {
            if (dataSync) {
                const photos = dataSync.getData('Photo');
                renderPhotos(photos);
            } else {
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
                const photos = loadDataFromStorage('Photo');
                if (photos.length === 0) {
                    // åŠ è½½é»˜è®¤ç…§ç‰‡
                    const defaultPhotos = [
                        {
                            url: 'https://doc.doubao.com/s/szwHoikLiug/',
                            title: 'ç¬¬ä¸€æ¬¡ç‰µæ‰‹',
                            description: 'åœ¨é‚£ä¸ªé˜³å…‰æ˜åªšçš„åˆå'
                        },
                        {
                            url: 'https://doc.doubao.com/s/tTEhEFPcRBY/',
                            title: 'æµ·è¾¹æ¼«æ­¥',
                            description: 'å¬ç€æµ·æµªå£°ï¼Œæ„Ÿå—å½¼æ­¤çš„å¿ƒè·³'
                        },
                        {
                            url: 'https://doc.doubao.com/s/ts-a_I7kjl4/',
                            title: 'æ¸©é¦¨æ—¶å…‰',
                            description: 'æœ€ç®€å•çš„å¹¸ç¦å°±æ˜¯å’Œä½ åœ¨ä¸€èµ·'
                        },
                        {
                            url: 'https://doc.doubao.com/s/uExmwHw7_Mk/',
                            title: 'çˆ±çš„æ‹¥æŠ±',
                            description: 'åœ¨ä½ æ€€é‡Œï¼Œæˆ‘æ‰¾åˆ°äº†å…¨ä¸–ç•Œ'
                        },
                        {
                            url: 'https://doc.doubao.com/s/HQNB-FL5R7M/',
                            title: 'æµªæ¼«çƒŸèŠ±',
                            description: 'çƒŸèŠ±å†ç¾ï¼Œä¹Ÿæ¯”ä¸ä¸Šä½ çš„ç¬‘å®¹'
                        },
                        {
                            url: 'https://doc.doubao.com/s/HyZdiZ_DXoc/',
                            title: 'çˆ±å¿ƒç¯å…‰',
                            description: 'æ¯ä¸€ç›ç¯éƒ½ä»£è¡¨æˆ‘å¯¹ä½ çš„çˆ±'
                        }
                    ];
                    
                    saveDataToStorage('Photo', defaultPhotos);
                    renderPhotos(defaultPhotos);
                } else {
                    renderPhotos(photos);
                }
            }
        }

        function renderPhotos(photos) {
            const photoGrid = document.getElementById('photoGrid');
            if (!photoGrid) return;
            
            photoGrid.innerHTML = '';
            
            photos.forEach((photo, index) => {
                const photoCard = `
                    <div class="group relative overflow-hidden rounded-2xl glass-effect hover:scale-105 transition-transform duration-300 hover-lift animate-fadeInUp" style="animation-delay: ${index * 0.1}s;">
                        <img src="${photo.url}" alt="${photo.title}" class="w-full h-64 object-cover group-hover:scale-110 transition-transform duration-500">
                        <button onclick="deletePhoto('${photo.id}')" class="delete-btn absolute top-3 right-3 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white hover:bg-red-600 transition-colors z-10">
                            <i class="fa fa-times text-sm"></i>
                        </button>
                        <div class="absolute inset-0 bg-gradient-to-t from-black/60 to-transparent opacity-0 group-hover:opacity-100 transition-opacity duration-300 flex items-end">
                            <div class="p-6 text-white">
                                <h3 class="text-xl font-semibold mb-2">${photo.title}</h3>
                                <p class="text-sm opacity-90">${photo.description}</p>
                            </div>
                        </div>
                    </div>
                `;
                photoGrid.innerHTML += photoCard;
            });
        }

        async function uploadPhotos(event) {
            const files = event.target.files;
            if (!files || files.length === 0) return;
            
            if (!dataSync) {
                showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            let uploadedCount = 0;
            
            Array.from(files).forEach(file => {
                if (file.type.startsWith('image/')) {
                    // å…ˆæ˜¾ç¤ºæœ¬åœ°é¢„è§ˆ
                    const reader = new FileReader();
                    reader.onload = async function(e) {
                        // æ˜¾ç¤ºä¸Šä¼ ä¸­çŠ¶æ€
                        showNotification(`æ­£åœ¨ä¸Šä¼ ç…§ç‰‡ ${uploadedCount + 1}/${files.length}...`, 'info');
                        
                        // ä¸Šä¼ åˆ°LeanCloud
                        const uploadResult = await dataSync.uploadFile(file, file.name);
                        
                        if (uploadResult) {
                            const newPhoto = {
                                url: uploadResult.url,
                                title: 'æ–°ç…§ç‰‡',
                                description: 'ç¾å¥½çš„å›å¿†',
                                timestamp: new Date().toISOString(),
                                fileName: file.name,
                                fileSize: file.size
                            };
                            
                            // æ·»åŠ åˆ°æ•°æ®åº“
                            const savedPhoto = await dataSync.addItem('Photo', newPhoto);
                            
                            if (savedPhoto) {
                                uploadedCount++;
                                showNotification(`ç…§ç‰‡ ${uploadedCount}/${files.length} ä¸Šä¼ æˆåŠŸï¼`, 'success');
                            }
                        }
                        
                        if (uploadedCount === files.length) {
                            showNotification(`æˆåŠŸä¸Šä¼  ${uploadedCount} å¼ ç…§ç‰‡ï¼`, 'success');
                        }
                    };
                    reader.onerror = function() {
                        showNotification('ç…§ç‰‡ä¸Šä¼ å¤±è´¥ï¼Œè¯·é‡è¯•ï¼', 'error');
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        async function deletePhoto(id) {
            if (!dataSync) {
                showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ ç…§ç‰‡å—ï¼Ÿ')) {
                const success = await dataSync.deleteItem('Photo', id);
                if (success) {
                    showNotification('ç…§ç‰‡åˆ é™¤æˆåŠŸï¼', 'success');
                }
            }
        }

        // æ—¥è®°ç›¸å…³åŠŸèƒ½
        function loadDiary() {
            if (dataSync) {
                const diaryEntries = dataSync.getData('Diary');
                renderDiary(diaryEntries);
            } else {
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
                const diaryEntries = loadDataFromStorage('Diary');
                if (diaryEntries.length === 0) {
                    // åŠ è½½é»˜è®¤æ—¥è®°
                    const defaultDiary = [
                        {
                            title: 'ç¬¬ä¸€æ¬¡ç›¸é‡',
                            date: '2024-01-15',
                            content: `è®°å¾—é‚£æ˜¯ä¸€ä¸ªå¯’å†·çš„å†¬æ—¥åˆåï¼Œæˆ‘åœ¨å’–å•¡é¦†é‡Œç¬¬ä¸€æ¬¡è§åˆ°äº†${partnerName}ã€‚ä½ ç©¿ç€ç™½è‰²çš„æ¯›è¡£ï¼Œé˜³å…‰é€è¿‡çª—æˆ·æ´’åœ¨ä½ èº«ä¸Šï¼Œé‚£ä¸€åˆ»æˆ‘ä»¿ä½›çœ‹åˆ°äº†å¤©ä½¿ã€‚æˆ‘ä»¬èŠäº†æ•´æ•´ä¸€ä¸‹åˆï¼Œä»å…´è¶£çˆ±å¥½åˆ°äººç”Ÿç†æƒ³ï¼Œæ„Ÿè§‰å°±åƒè®¤è¯†äº†å¾ˆä¹…å¾ˆä¹…...`
                        },
                        {
                            title: 'ç¬¬ä¸€æ¬¡çº¦ä¼š',
                            date: '2024-02-14',
                            content: `æƒ…äººèŠ‚é‚£å¤©ï¼Œæˆ‘é¼“è¶³å‹‡æ°”çº¦${partnerName}å‡ºæ¥ã€‚æˆ‘ä»¬å»çœ‹äº†ä¸€åœºæµªæ¼«çš„ç”µå½±ï¼Œç„¶ååœ¨æ²³è¾¹æ•£æ­¥ã€‚å½“æˆ‘ç‰µèµ·ä½ çš„æ‰‹æ—¶ï¼Œæˆ‘çš„å¿ƒè·³å¾—å¥½å¿«ã€‚ä½ å‘Šè¯‰æˆ‘ï¼Œä½ ä¹Ÿå–œæ¬¢æˆ‘å¾ˆä¹…äº†ã€‚é‚£ä¸€åˆ»ï¼Œæˆ‘è§‰å¾—æ•´ä¸ªä¸–ç•Œéƒ½å˜å¾—ç¾å¥½èµ·æ¥...`
                        }
                    ];
                    
                    saveDataToStorage('Diary', defaultDiary);
                    renderDiary(defaultDiary);
                } else {
                    renderDiary(diaryEntries);
                }
            }
        }

        function renderDiary(entries) {
            const diaryList = document.getElementById('diaryList');
            if (!diaryList) return;
            
            diaryList.innerHTML = '';
            
            entries.forEach((entry, index) => {
                const diaryCard = `
                    <div class="glass-effect rounded-3xl p-8 hover-lift animate-fadeInUp" style="animation-delay: ${index * 0.1}s;">
                        <div class="flex justify-between items-start mb-4">
                            <div class="flex items-center space-x-2">
                                <h3 class="text-xl font-semibold text-white">${entry.title}</h3>
                                <span class="text-sm text-white/60 font-elegant">${entry.date}</span>
                            </div>
                            <button onclick="deleteDiary('${entry.id}')" class="delete-btn w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white hover:bg-red-600 transition-colors">
                                <i class="fa fa-times text-sm"></i>
                            </button>
                        </div>
                        <p class="text-white/80 leading-relaxed font-elegant mb-4">${entry.content}</p>
                        <div class="flex items-center space-x-6 text-sm text-white/60">
                            <span><i class="fa fa-heart mr-1 text-love-300"></i>æ°¸è¿œéš¾å¿˜</span>
                            <span><i class="fa fa-star mr-1 text-love-300"></i>ç¾å¥½å›å¿†</span>
                        </div>
                    </div>
                `;
                diaryList.innerHTML += diaryCard;
            });
        }

        function showAddDiaryModal() {
            const modal = document.getElementById('addDiaryModal');
            if (modal) {
                modal.classList.remove('hidden');
                // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
                const diaryDate = document.getElementById('diaryDate');
                if (diaryDate) {
                    diaryDate.value = new Date().toISOString().split('T')[0];
                }
            }
        }

        function hideAddDiaryModal() {
            const modal = document.getElementById('addDiaryModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        async function addDiary() {
            const titleInput = document.getElementById('diaryTitle');
            const dateInput = document.getElementById('diaryDate');
            const contentInput = document.getElementById('diaryContent');
            
            if (!titleInput || !dateInput || !contentInput) return;
            
            const title = titleInput.value.trim();
            const date = dateInput.value;
            const content = contentInput.value.trim();
            
            if (title && date && content) {
                if (!dataSync) {
                    showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                    return;
                }
                
                const newEntry = { 
                    title, 
                    date, 
                    content,
                    author: yourName
                };
                
                const savedEntry = await dataSync.addItem('Diary', newEntry);
                
                if (savedEntry) {
                    hideAddDiaryModal();
                    titleInput.value = '';
                    contentInput.value = '';
                    showNotification('æ—¥è®°æ·»åŠ æˆåŠŸï¼', 'success');
                }
            } else {
                showNotification('è¯·å¡«å†™å®Œæ•´çš„æ—¥è®°ä¿¡æ¯ï¼', 'error');
            }
        }

        async function deleteDiary(id) {
            if (!dataSync) {
                showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ç¯‡æ—¥è®°å—ï¼Ÿ')) {
                const success = await dataSync.deleteItem('Diary', id);
                if (success) {
                    showNotification('æ—¥è®°åˆ é™¤æˆåŠŸï¼', 'success');
                }
            }
        }

        // ç•™è¨€ç›¸å…³åŠŸèƒ½
        function loadMessages() {
            if (dataSync) {
                const messages = dataSync.getData('Message');
                renderMessages(messages);
            } else {
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
                const messages = loadDataFromStorage('Message');
                if (messages.length === 0) {
                    // åŠ è½½é»˜è®¤ç•™è¨€
                    const defaultMessages = [
                        {
                            sender: partnerName,
                            content: `äº²çˆ±çš„${yourName}ï¼Œä»Šå¤©ä¹Ÿè¶…çº§çˆ±ä½ ï¼ä½ æ˜¯æˆ‘ç”Ÿå‘½ä¸­æœ€ç¾çš„é˜³å…‰ï¼Œæœ‰ä½ åœ¨èº«è¾¹æ¯å¤©éƒ½å……æ»¡æ¸©æš–ã€‚`,
                            timestamp: new Date().toISOString()
                        },
                        {
                            sender: yourName,
                            content: `è°¢è°¢ä½ æ¥åˆ°æˆ‘çš„ç”Ÿå‘½ä¸­ï¼Œè®©æˆ‘çŸ¥é“ä»€ä¹ˆæ˜¯çœŸæ­£çš„å¹¸ç¦ã€‚æ— è®ºé‡åˆ°ä»€ä¹ˆå›°éš¾ï¼Œæˆ‘ä»¬éƒ½è¦ä¸€èµ·é¢å¯¹ï¼Œæ°¸è¿œä¸åˆ†ç¦»ã€‚`,
                            timestamp: new Date(Date.now() - 86400000).toISOString()
                        }
                    ];
                    
                    saveDataToStorage('Message', defaultMessages);
                    renderMessages(defaultMessages);
                } else {
                    renderMessages(messages);
                }
            }
        }

        function renderMessages(messages) {
            const messageList = document.getElementById('messageList');
            if (!messageList) return;
            
            messageList.innerHTML = '';
            
            messages.forEach((message, index) => {
                try {
                    const date = new Date(message.createdAt || message.timestamp);
                    const timeString = date.toLocaleTimeString([], { hour: '2-digit', minute: '2-digit' });
                    const dateString = date.toLocaleDateString([], { month: 'short', day: 'numeric' });
                    
                    const isCurrentUser = message.sender === yourName;
                    const messageCard = `
                        <div class="glass-effect rounded-3xl p-6 hover-lift animate-fadeInUp" style="animation-delay: ${index * 0.1}s; ${isCurrentUser ? 'border-l-4 border-love-300' : 'border-r-4 border-blue-300'}">
                            <div class="flex justify-between items-start mb-2">
                                <div class="flex items-center space-x-2">
                                    <span class="font-semibold text-white">${message.sender}</span>
                                    <span class="text-xs text-white/60 font-elegant">${dateString} ${timeString}</span>
                                </div>
                                <button onclick="deleteMessage('${message.id}')" class="delete-btn w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white hover:bg-red-600 transition-colors">
                                    <i class="fa fa-times text-sm"></i>
                                </button>
                            </div>
                            <p class="text-white/80 leading-relaxed font-elegant mb-3">${message.content}</p>
                            <div class="flex items-center space-x-4 text-sm">
                                <button onclick="likeMessage('${message.id}')" class="text-love-300 hover:text-love-200 transition-colors hover:scale-110 transition-transform">
                                    <i class="fa fa-heart mr-1"></i>å–œæ¬¢
                                </button>
                                <button onclick="replyToMessage('${message.id}')" class="text-white/60 hover:text-white transition-colors hover:scale-110 transition-transform">
                                    <i class="fa fa-reply mr-1"></i>å›å¤
                                </button>
                            </div>
                        </div>
                    `;
                    messageList.innerHTML += messageCard;
                } catch (error) {
                    console.error('Failed to render message:', error);
                }
            });
        }

        async function addMessage() {
            const messageInput = document.getElementById('messageInput');
            if (!messageInput) return;
            
            const content = messageInput.value.trim();
            
            if (content) {
                if (!dataSync) {
                    showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                    return;
                }
                
                const newMessage = {
                    sender: yourName,
                    content: content,
                    timestamp: new Date().toISOString()
                };
                
                const savedMessage = await dataSync.addItem('Message', newMessage);
                
                if (savedMessage) {
                    messageInput.value = '';
                    
                    // æ·»åŠ å‘é€åŠ¨ç”»
                    createSendAnimation();
                    
                    showNotification('ç•™è¨€å‘é€æˆåŠŸï¼', 'success');
                }
            } else {
                showNotification('è¯·è¾“å…¥ç•™è¨€å†…å®¹ï¼', 'error');
            }
        }

        // åˆ›å»ºå‘é€åŠ¨ç”»
        function createSendAnimation() {
            const messageList = document.getElementById('messageList');
            if (!messageList) return;
            
            const animation = document.createElement('div');
            animation.className = 'fixed bottom-20 right-20 text-4xl animate-scaleIn z-50';
            animation.textContent = 'ğŸ’Œ';
            document.body.appendChild(animation);
            
            setTimeout(() => {
                animation.style.opacity = '0';
                animation.style.transition = 'opacity 1s ease-out';
                setTimeout(() => {
                    if (animation.parentNode) {
                        animation.parentNode.removeChild(animation);
                    }
                }, 1000);
            }, 2000);
        }

        async function deleteMessage(id) {
            if (!dataSync) {
                showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™æ¡ç•™è¨€å—ï¼Ÿ')) {
                const success = await dataSync.deleteItem('Message', id);
                if (success) {
                    showNotification('ç•™è¨€åˆ é™¤æˆåŠŸï¼', 'success');
                }
            }
        }

        async function likeMessage(id) {
            if (!dataSync) {
                showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            const messages = dataSync.getData('Message');
            const message = messages.find(m => m.id === id);
            
            if (message) {
                const updatedMessage = {
                    ...message,
                    liked: !message.liked,
                    likeCount: (message.likeCount || 0) + (message.liked ? -1 : 1)
                };
                
                await dataSync.updateItem('Message', id, updatedMessage);
                showNotification(message.liked ? 'å·²å–æ¶ˆç‚¹èµï¼' : 'å·²ç‚¹èµï¼', 'success');
            }
        }

        function replyToMessage(id) {
            const messages = dataSync ? dataSync.getData('Message') : loadDataFromStorage('Message');
            const message = messages.find(m => m.id === id);
            
            if (message) {
                const messageInput = document.getElementById('messageInput');
                if (messageInput) {
                    messageInput.value = `å›å¤ @${message.sender}ï¼š`;
                    messageInput.focus();
                }
            }
        }

        // çºªå¿µæ—¥ç›¸å…³åŠŸèƒ½
        function loadAnniversaries() {
            if (dataSync) {
                const anniversaries = dataSync.getData('Anniversary');
                renderAnniversaries(anniversaries);
            } else {
                // ä»æœ¬åœ°å­˜å‚¨åŠ è½½
                const anniversaries = loadDataFromStorage('Anniversary');
                if (anniversaries.length === 0) {
                    // åŠ è½½é»˜è®¤çºªå¿µæ—¥
                    const defaultAnniversaries = [
                        {
                            title: 'ç›¸è¯†çºªå¿µæ—¥',
                            date: '2024-01-15',
                            icon: 'heart'
                        },
                        {
                            title: 'æ‹çˆ±çºªå¿µæ—¥',
                            date: '2024-02-14',
                            icon: 'gift'
                        },
                        {
                            title: 'åˆå»çºªå¿µæ—¥',
                            date: '2024-03-01',
                            icon: 'star'
                        },
                        {
                            title: 'ç¬¬ä¸€æ¬¡æ—…è¡Œ',
                            date: '2024-05-20',
                            icon: 'travel'
                        },
                        {
                            title: 'æ±‚å©šçºªå¿µæ—¥',
                            date: '2024-10-01',
                            icon: 'ring'
                        }
                    ];
                    
                    saveDataToStorage('Anniversary', defaultAnniversaries);
                    renderAnniversaries(defaultAnniversaries);
                } else {
                    renderAnniversaries(anniversaries);
                }
            }
        }

        function renderAnniversaries(anniversaries) {
            const anniversaryGrid = document.getElementById('anniversaryGrid');
            if (!anniversaryGrid) return;
            
            anniversaryGrid.innerHTML = '';
            
            anniversaries.forEach((anniversary, index) => {
                try {
                    const date = new Date(anniversary.date);
                    const now = new Date();
                    const diff = now - date;
                    const days = Math.floor(diff / (1000 * 60 * 60 * 24));
                    
                    const icons = {
                        heart: 'â¤ï¸',
                        gift: 'ğŸ',
                        star: 'â­',
                        calendar: 'ğŸ“…',
                        camera: 'ğŸ“·',
                        ring: 'ğŸ’',
                        music: 'ğŸµ',
                        travel: 'âœˆï¸'
                    };
                    
                    const anniversaryCard = `
                        <div class="glass-effect rounded-3xl p-6 text-center hover:scale-105 transition-transform duration-300 relative hover-lift animate-fadeInUp" style="animation-delay: ${index * 0.1}s;">
                            <button onclick="deleteAnniversary('${anniversary.id}')" class="delete-btn absolute top-3 right-3 w-8 h-8 bg-red-500 rounded-full flex items-center justify-center text-white hover:bg-red-600 transition-colors z-10">
                                <i class="fa fa-times text-sm"></i>
                            </button>
                            <div class="w-16 h-16 gradient-love rounded-full flex items-center justify-center mx-auto mb-4 animate-pulseGlow">
                                <span class="text-2xl">${icons[anniversary.icon] || 'â¤ï¸'}</span>
                            </div>
                            <h3 class="text-xl font-semibold text-white mb-2">${anniversary.title}</h3>
                            <p class="text-white/70 font-elegant mb-4">${anniversary.date}</p>
                            <div class="text-2xl font-bold gradient-text mb-2">${days.toLocaleString()}</div>
                            <div class="text-white/60 text-sm font-elegant">å¤©å‰</div>
                        </div>
                    `;
                    anniversaryGrid.innerHTML += anniversaryCard;
                } catch (error) {
                    console.error('Failed to render anniversary:', error);
                }
            });
        }

        function showAddAnniversaryModal() {
            const modal = document.getElementById('addAnniversaryModal');
            if (modal) {
                modal.classList.remove('hidden');
                // è®¾ç½®é»˜è®¤æ—¥æœŸä¸ºä»Šå¤©
                const anniversaryDate = document.getElementById('anniversaryDate');
                if (anniversaryDate) {
                    anniversaryDate.value = new Date().toISOString().split('T')[0];
                }
            }
        }

        function hideAddAnniversaryModal() {
            const modal = document.getElementById('addAnniversaryModal');
            if (modal) {
                modal.classList.add('hidden');
            }
        }

        async function addAnniversary() {
            const titleInput = document.getElementById('anniversaryTitle');
            const dateInput = document.getElementById('anniversaryDate');
            const iconSelect = document.getElementById('anniversaryIcon');
            
            if (!titleInput || !dateInput || !iconSelect) return;
            
            const title = titleInput.value.trim();
            const date = dateInput.value;
            const icon = iconSelect.value;
            
            if (title && date) {
                const selectedDate = new Date(date);
                const now = new Date();
                
                if (selectedDate <= now) {
                    if (!dataSync) {
                        showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                        return;
                    }
                    
                    const newAnniversary = { title, date, icon };
                    
                    const savedAnniversary = await dataSync.addItem('Anniversary', newAnniversary);
                    
                    if (savedAnniversary) {
                        hideAddAnniversaryModal();
                        titleInput.value = '';
                        showNotification('çºªå¿µæ—¥æ·»åŠ æˆåŠŸï¼', 'success');
                    }
                } else {
                    showNotification('è¯·é€‰æ‹©ä»Šå¤©æˆ–è¿‡å»çš„æ—¥æœŸï¼', 'error');
                }
            } else {
                showNotification('è¯·å¡«å†™å®Œæ•´çš„çºªå¿µæ—¥ä¿¡æ¯ï¼', 'error');
            }
        }

        async function deleteAnniversary(id) {
            if (!dataSync) {
                showNotification('æ•°æ®åŒæ­¥æœåŠ¡æœªåˆå§‹åŒ–', 'error');
                return;
            }
            
            if (confirm('ç¡®å®šè¦åˆ é™¤è¿™ä¸ªçºªå¿µæ—¥å—ï¼Ÿ')) {
                const success = await dataSync.deleteItem('Anniversary', id);
                if (success) {
                    showNotification('çºªå¿µæ—¥åˆ é™¤æˆåŠŸï¼', 'success');
                }
            }
        }

        // æœ¬åœ°å­˜å‚¨è¾…åŠ©å‡½æ•°
        function loadDataFromStorage(type) {
            try {
                const data = localStorage.getItem(`loveSite${type}`);
                return data ? JSON.parse(data) : [];
            } catch (error) {
                console.error(`Failed to load local ${type} data:`, error);
                return [];
            }
        }

        function saveDataToStorage(type, data) {
            try {
                localStorage.setItem(`loveSite${type}`, JSON.stringify(data));
            } catch (error) {
                console.error(`Failed to save local ${type} data:`, error);
            }
        }

        // å¹³æ»‘æ»šåŠ¨åˆ°æŒ‡å®šåŒºåŸŸ
        function scrollToSection(sectionId) {
            const element = document.getElementById(sectionId);
            if (element) {
                element.scrollIntoView({ 
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        }

        // æ˜¾ç¤ºé€šçŸ¥
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            const colors = {
                success: 'bg-green-500',
                error: 'bg-red-500',
                info: 'bg-blue-500',
                warning: 'bg-yellow-500'
            };
            
            notification.className = `fixed top-20 right-4 z-50 px-6 py-3 rounded-lg text-white font-elegant transform translate-x-full transition-transform duration-300 ${colors[type] || colors.info}`;
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            setTimeout(() => {
                notification.classList.add('translate-x-full');
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.parentNode.removeChild(notification);
                    }
                }, 300);
            }, 3000);
        }

        // é”®ç›˜äº‹ä»¶ç›‘å¬
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Enter' && e.target.id === 'messageInput' && !e.shiftKey) {
                e.preventDefault();
                addMessage();
            }
            
            // ESCé”®å…³é—­æ¨¡æ€æ¡†
            if (e.key === 'Escape') {
                hideAddDiaryModal();
                hideAddAnniversaryModal();
            }
        });

        // å¯¼èˆªæ æ»šåŠ¨æ•ˆæœ
        window.addEventListener('scroll', function() {
            const nav = document.querySelector('nav');
            if (nav) {
                if (window.scrollY > 100) {
                    nav.style.background = 'rgba(255, 255, 255, 0.35)';
                    nav.style.backdropFilter = 'blur(20px)';
                } else {
                    nav.style.background = 'rgba(255, 255, 255, 0.25)';
                    nav.style.backdropFilter = 'blur(10px)';
                }
            }
        });

        // é¡µé¢å¯è§æ€§å˜åŒ–æ—¶å¤„ç†
        document.addEventListener('visibilitychange', function() {
            if (document.hidden) {
                // é¡µé¢éšè—æ—¶åœæ­¢è®¡æ—¶å™¨
                if (timerInterval) {
                    clearInterval(timerInterval);
                    timerInterval = null;
                }
            } else {
                // é¡µé¢æ˜¾ç¤ºæ—¶é‡æ–°å¼€å§‹è®¡æ—¶å™¨
                if (isTimerRunning && !isTimerPaused) {
                    startTimer();
                }
                
                // é¡µé¢æ˜¾ç¤ºæ—¶è‡ªåŠ¨åŒæ­¥æ•°æ®
                if (dataSync) {
                    setTimeout(() => {
                        dataSync.syncAllData();
                    }, 1000);
                }
            }
        });

        // é¡µé¢å¸è½½æ—¶æ¸…ç†
        window.addEventListener('beforeunload', function() {
            stopTimer();
        });

        // æ·»åŠ ä¸€äº›äº¤äº’æ•ˆæœ
        document.addEventListener('click', function(e) {
            // åˆ›å»ºç‚¹å‡»æ•ˆæœ
            createClickEffect(e.clientX, e.clientY);
        });

        // åˆ›å»ºç‚¹å‡»æ•ˆæœ
        function createClickEffect(x, y) {
            const effect = document.createElement('div');
            effect.className = 'fixed pointer-events-none z-50 text-2xl animate-scaleIn opacity-70';
            effect.textContent = ['ğŸ’•', 'ğŸ’–', 'ğŸ’˜', 'ğŸ’', 'ğŸ’“', 'ğŸ’—'][Math.floor(Math.random() * 6)];
            effect.style.left = x + 'px';
            effect.style.top = y + 'px';
            effect.style.transform = 'translate(-50%, -50%)';
            
            document.body.appendChild(effect);
            
            setTimeout(() => {
                effect.style.opacity = '0';
                effect.style.transition = 'opacity 1s ease-out';
                setTimeout(() => {
                    if (effect.parentNode) {
                        effect.parentNode.removeChild(effect);
                    }
                }, 1000);
            }, 1000);
        }

        // æš´éœ²ç»™å…¨å±€çš„é€šçŸ¥å‡½æ•°ï¼ˆä¾›leancloud-proxyä½¿ç”¨ï¼‰
        window.showNotification = showNotification;
    </script>
</body>
</html>
